<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹ | duangdongçš„deploy</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="å‰ç«¯éƒ¨ç½²ç›¸å…³çŸ¥è¯†å½’çº³æ€»ç»“">
    <meta name="keywords" content="qd-blog,vuepress,deploy,algorithm">
    
    <link rel="preload" href="/assets/css/0.styles.b4a844ec.css" as="style"><link rel="preload" href="/assets/js/app.5605bad5.js" as="script"><link rel="preload" href="/assets/js/2.57da4f88.js" as="script"><link rel="preload" href="/assets/js/1.a76cc220.js" as="script"><link rel="preload" href="/assets/js/31.ffa03d48.js" as="script"><link rel="prefetch" href="/assets/js/10.50f73657.js"><link rel="prefetch" href="/assets/js/11.0390ceee.js"><link rel="prefetch" href="/assets/js/12.f88bec36.js"><link rel="prefetch" href="/assets/js/13.963ad03b.js"><link rel="prefetch" href="/assets/js/14.512f15b9.js"><link rel="prefetch" href="/assets/js/15.a674496c.js"><link rel="prefetch" href="/assets/js/16.ed7e507f.js"><link rel="prefetch" href="/assets/js/17.de667ca5.js"><link rel="prefetch" href="/assets/js/18.b44e84af.js"><link rel="prefetch" href="/assets/js/19.5b5ad6a1.js"><link rel="prefetch" href="/assets/js/20.6800493a.js"><link rel="prefetch" href="/assets/js/21.6589052c.js"><link rel="prefetch" href="/assets/js/22.f648d829.js"><link rel="prefetch" href="/assets/js/23.39476763.js"><link rel="prefetch" href="/assets/js/24.30c66c19.js"><link rel="prefetch" href="/assets/js/25.d4789860.js"><link rel="prefetch" href="/assets/js/26.cd1d4827.js"><link rel="prefetch" href="/assets/js/27.3a1583ca.js"><link rel="prefetch" href="/assets/js/28.c4f500b3.js"><link rel="prefetch" href="/assets/js/29.b00b6f3d.js"><link rel="prefetch" href="/assets/js/3.13e892f5.js"><link rel="prefetch" href="/assets/js/30.b94c8f97.js"><link rel="prefetch" href="/assets/js/32.49755c34.js"><link rel="prefetch" href="/assets/js/33.564913a6.js"><link rel="prefetch" href="/assets/js/34.26ee9415.js"><link rel="prefetch" href="/assets/js/35.3c086aef.js"><link rel="prefetch" href="/assets/js/36.7826c489.js"><link rel="prefetch" href="/assets/js/37.e05a3d1a.js"><link rel="prefetch" href="/assets/js/38.9f1b6eb2.js"><link rel="prefetch" href="/assets/js/39.a84b9189.js"><link rel="prefetch" href="/assets/js/4.5bdb9365.js"><link rel="prefetch" href="/assets/js/40.cb6d6026.js"><link rel="prefetch" href="/assets/js/41.861bfae4.js"><link rel="prefetch" href="/assets/js/42.64a03d8e.js"><link rel="prefetch" href="/assets/js/43.79fc731c.js"><link rel="prefetch" href="/assets/js/44.c78ff1b8.js"><link rel="prefetch" href="/assets/js/45.5bf96c84.js"><link rel="prefetch" href="/assets/js/5.7c68fdb5.js"><link rel="prefetch" href="/assets/js/6.c8da7ca7.js"><link rel="prefetch" href="/assets/js/7.e4c88d0e.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5143d2e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4a844ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdongçš„deploy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/deploy/" class="nav-link">
  éƒ¨ç½²
</a></div><div class="nav-item"><a href="/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/cluster/" class="nav-link">
  é›†ç¾¤
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  è¿ç»´
</a></div><div class="nav-item"><a href="/linux-shell/" class="nav-link">
  Linuxç›¸å…³
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/deploy/" class="nav-link">
  éƒ¨ç½²
</a></div><div class="nav-item"><a href="/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/cluster/" class="nav-link">
  é›†ç¾¤
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  è¿ç»´
</a></div><div class="nav-item"><a href="/linux-shell/" class="nav-link">
  Linuxç›¸å…³
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docker/" aria-current="page" class="sidebar-link">éƒ¨ç½²</a></li><li><a href="/docker/NodeJsæœåŠ¡Dockeré•œåƒæè‡´ä¼˜åŒ–æŒ‡åŒ—.html" class="sidebar-link">NodeJS æœåŠ¡ Docker é•œåƒæè‡´ä¼˜åŒ–æŒ‡åŒ—</a></li><li><a href="/docker/docker-webhookä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½².html" class="sidebar-link">docker + webhook ä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²</a></li><li><a href="/docker/dockerç›¸å…³.html" class="sidebar-link">å…³äºDockerç›¸å…³å‘½ä»¤</a></li><li><a href="/docker/å‰ç«¯è¿ç»´.html" class="active sidebar-link">å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹"><a href="#å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹" class="header-anchor">#</a> å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹</h2> <blockquote><p><a href="https://mp.weixin.qq.com/s/2-DIsGx9rKNxdRyYBFTv9w" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/2-DIsGx9rKNxdRyYBFTv9w<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>â</p> <p>èŠåˆ°è¿ç»´ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘è§‰å¾—è·Ÿå‰ç«¯å°±æ˜¯æ¯«æ— å…³è”çš„ç©æ„ï¼Œåº”è¯¥è¯´åŠæ¯›é’±å…³ç³»éƒ½æœ¨ã€‚ä½†éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„å‘å±•ï¼Œå‰ç«¯åŸºæœ¬è¿ç»´éƒ¨ç½²ç›¸å…³çŸ¥è¯†ç”šè‡³ä¹Ÿé€æ­¥è¢«é‡è§†ï¼Œå¦‚æœä½ å…¬å¸çš„è¿ç»´éƒ¨é—¨å¾ˆå¼ºå¤§ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥å®Œå…¨å¿½ç•¥è¿ç»´ç›¸å…³çš„ã€‚åªæ˜¯æ ‘é…±è§‰å¾—ï¼Œå¦‚æœä½ æƒ³æ›´å¤šäº†è§£å‰ç«¯æ¶æ„ï¼Œè¿˜æ˜¯éœ€è¦å…·å¤‡ä¸€å®šçš„è¿ç»´ç›¸å…³çŸ¥è¯†å‚¨å¤‡ã€‚å½“ç„¶ï¼Œç°åœ¨äº‘å‚å•†éƒ½æƒ³åº”æ¨å‡ºè‡ªå·±çš„ServerlessæœåŠ¡(ä¸‹ä¸€ç¯‡ä¼šè®²ï½)ï¼Œå·ç§°è®©å‰ç«¯æ›´ä¸“æ³¨ä¸šåŠ¡çš„å¼€å‘ï¼Œè€Œä¸ç”¨æ‹…å¿ƒåº•å±‚åº”ç”¨çš„éƒ¨ç½²å’Œç»´æŠ¤ï¼Œå¯¹å¼€å‘è€…è€Œè¨€å¯ä»¥æ›´å¤šèšç„¦åˆ°ä¸šåŠ¡é¢†åŸŸçš„å¼€å‘ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥å»ç©ç©</p> <p>â</p></blockquote> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCKYibfFPCh90jh87WLWneqJHOXKeacibagaOvNmzcZUYC7ubnlq30G2Qw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h3 id="_1-npm"><a href="#_1-npm" class="header-anchor">#</a> 1.npm</h3> <blockquote><p>â</p> <p>npm æ˜¯ Node.js å®˜æ–¹æä¾›çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå‘å¸ƒç­‰ç­‰ï¼Œä¸‹é¢ä»‹ç»å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„éƒ¨ç½²åº”ç”¨åœºæ™¯ï¼Œå¸¸ç”¨çš„npmå‘½ä»¤è¿™é‡Œä¸ä½œä»‹ç»äº†</p> <p>â</p></blockquote> <h4 id="_1-1-nrm"><a href="#_1-1-nrm" class="header-anchor">#</a> 1.1 nrm</h4> <blockquote><p>â</p> <p>nrm(npm registry manager )æ˜¯npmçš„é•œåƒæºç®¡ç†å·¥å…·ï¼Œå› ä¸ºnpmé»˜è®¤å»ºç«‹çš„é“¾æ¥è®¿é—®çš„æ˜¯å›½å¤–çš„èµ„æºï¼Œè®¿é—®é€Ÿåº¦è¾ƒæ…¢ï¼Œä½¿ç”¨è¿™ä¸ªå°±å¯ä»¥å¿«é€Ÿåœ°åœ¨ npm æºé—´åˆ‡</p> <p>â</p></blockquote> <ul><li>å¦‚ä½•å®‰è£…</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> nrm
</code></pre></div><ul><li>æŸ¥çœ‹å¯é€‰çš„èµ„æº</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>nrm <span class="token function">ls</span>   

*npm ---- https://registry.npmjs.org/

cnpm --- http://r.cnpmjs.org/

taobao - http://registry.npm.taobao.org/

eu ----- http://registry.npmjs.eu/
<span class="token punctuation">..</span>.
</code></pre></div><ul><li>æ·»åŠ ç§æœ‰ä»“åº“é“¾æ¥</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>nrm <span class="token function">add</span> name http://registry.npm.tree.com/  <span class="token comment"># ç§æœ‰ä»“åº“é“¾æ¥</span>
nrm use name <span class="token comment"># ä½¿ç”¨æœ¬å€çš„é•œåƒåœ°å€</span>
</code></pre></div><p>nrm æ›´å¤šç”¨äºå¦‚æœå…¬å¸å†…ç½‘éƒ¨ç½²äº†ç§æœ‰ä»“åº“ï¼Œä¹Ÿå°±æ˜¯æ–¹ä¾¿ç”¨nrmä½œæ¥æºåˆ‡æ¢ï¼Œä¹Ÿæœ‰ç›Šäºä¾èµ–çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå¦‚æœä½ æƒ³æ­å»ºè‡ªå·±çš„ç§æœ‰ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨verdaccioï¼Œå¯ä»¥çœ‹è¿™ä¸ªå…·ä½“çš„æ•™ç¨‹ ç‚¹æˆ‘</p> <h4 id="_1-2-å‘å¸ƒnpmåŒ…"><a href="#_1-2-å‘å¸ƒnpmåŒ…" class="header-anchor">#</a> 1.2 å‘å¸ƒnpmåŒ…</h4> <blockquote><p>â</p> <p>å½“æˆ‘ä»¬æƒ³å‘å¸ƒä¸€ä¸ªnpmåŒ…ï¼Œéœ€è¦å®Œæˆä»€ä¹ˆæ ·çš„æµç¨‹å‘¢ï¼Ÿ</p> <p>â</p></blockquote> <ul><li>å…ˆæ³¨å†Œnpmè´¦å· ğŸ”—</li> <li>é…ç½®package.json</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kutil&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span> #ç‰ˆæœ¬åç§°
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> # å¯æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤
  <span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/xxx/xxx.git&quot;</span><span class="token punctuation">,</span> #githubä»“åº“åœ°å€
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tree &lt;shuxin_liu@kingdee.com&gt;&quot;</span><span class="token punctuation">,</span> #ä½œè€…
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> &quot;å·¥å…·åŒ…â€œ<span class="token punctuation">,</span> #åŒ…çš„è¯´æ˜
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;utils&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>é…ç½®æ‰“åŒ…æœºåˆ¶</li></ul> <blockquote><p>â</p> <p>å¦‚æœæ˜¯å·¥å…·ç±»æ‰“åŒ…ï¼Œæ¨èä½¿ç”¨rollupï¼Œwebpackæ¯”è¾ƒé€‚åˆæ‰“åŒ…ä¸€äº›åº”ç”¨ï¼Œä¾‹å¦‚SPAæˆ–è€…åŒæ„é¡¹ç›®</p> <p>â</p></blockquote> <ul><li>æ·»åŠ å•å…ƒæµ‹è¯•</li></ul> <blockquote><p>â</p> <p>ä¼˜è´¨çš„å¼€æºåŒ…ï¼Œéƒ½æœ‰å•å…ƒæµ‹è¯•æ¨¡å—ï¼Œæ¥ä¿è¯åŒ…çš„ç¨³å®šæ€§å’Œä»£ç è´¨é‡ï¼Œå¸¸è§ä¼šæœ‰build-passingçš„æ ‡è®°ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥é˜…è¯»æ ‘é…±ä¹‹å‰å†™çš„å‰ç«¯å•å…ƒæµ‹è¯•é‚£äº›äº‹</p> <p>â</p></blockquote> <ul><li>å¼€å‘æ–‡æ¡£readme.me</li></ul> <blockquote><p>â</p> <p>readmeæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿç†Ÿæ‚‰ï¼ŒåŒ…æ‹¬å…·ä½“çš„Apiä»‹ç»ã€ä½¿ç”¨ä¾‹å­ã€é¡¹ç›®ä»‹ç»ç­‰ç­‰ï¼Œè¿˜å¯ä»¥åŠ å…¥åŒ…æ‹¬å•å…ƒæµ‹è¯•è¦†ç›–ç‡ã€ä¸‹è½½é‡ã€è¯ä¹¦ç­‰ç­‰</p> <p>â</p></blockquote> <p>æœ€åå®Œæˆä¸Šé¢ä¸€ç³»åˆ—æ“ä½œä¹‹åï¼Œåˆ°äº†æœ€ç»ˆçš„å‘å¸ƒç¯èŠ‚</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> login <span class="token comment"># ç™»å½•ä½ ä¸Šé¢æ³¨å†Œçš„npmè´¦å·</span>

<span class="token function">npm</span> publish <span class="token comment"># ç™»å½•æˆåŠŸåï¼Œæ‰§è¡Œå‘å¸ƒå‘½ä»¤</span>

+ kutil@1.0.0 <span class="token comment"># å‘å¸ƒæˆåŠŸæ˜¾ç¤ºnpmæŠ¥ååŠåŒ…çš„ç‰ˆæœ¬å·</span>
</code></pre></div><h3 id="_2-jenkins"><a href="#_2-jenkins" class="header-anchor">#</a> 2. jenkins</h3> <blockquote><p>â</p> <p>jenkinsä½œä¸ºä¸€ä¸ªå¯æ‰©å±•çš„è‡ªåŠ¨åŒ–æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨ä½œç®€å•çš„ CI æœåŠ¡å™¨ï¼Œå…·æœ‰è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰åŠŸèƒ½ï¼Œç®€è€Œè¨€ä¹‹ï¼Œjenkinså¯ä»¥æ–¹ä¾¿æˆ‘ä»¬æ—¥å¸¸çš„å‰ç«¯é¡¹ç›®ç‰ˆæœ¬æ›´æ–°è¿­ä»£ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ƒè‡ªåŠ¨åŒ–å®Œæˆä¸€ç³»åˆ—çš„æ“ä½œåŒ…æ‹¬ï¼šç¼–è¯‘æ‰“åŒ…å…ƒæµ‹è¯•ã€ä»£ç æ‰«æç­‰ï¼Œå®˜æ–¹æ–‡æ¡£</p> <p>â</p></blockquote> <h4 id="_2-1-å¦‚ä½•å®‰è£…"><a href="#_2-1-å¦‚ä½•å®‰è£…" class="header-anchor">#</a> 2.1 å¦‚ä½•å®‰è£…</h4> <ul><li>ä¸‹è½½ Jenkins.</li> <li>æ‰“å¼€ç»ˆç«¯è¿›å…¥åˆ°ä¸‹è½½ç›®å½•.</li> <li>è¿è¡Œå‘½ä»¤ <code>java -jar jenkins.war --httpPort=8080.</code></li> <li>æ‰“å¼€æµè§ˆå™¨è¿›å…¥é“¾æ¥ http://localhost:8080.</li> <li>æŒ‰ç…§è¯´æ˜å®Œæˆå®‰è£….</li></ul> <p>è¯¦ç»†æµç¨‹å›¾å¯å‚è€ƒ Jenkins+github å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²</p> <h4 id="_2-2-é…åˆå‰ç«¯é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#_2-2-é…åˆå‰ç«¯é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²" class="header-anchor">#</a> 2.2 é…åˆå‰ç«¯é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²</h4> <blockquote><p>â</p> <p>è¿™é‡Œä¸»è¦ä»‹ç»jenkinsæµæ°´çº¿é…ç½®çš„ä½¿ç”¨ï¼Œæµæ°´çº¿çš„ä»£ç å®šä¹‰äº†æ•´ä¸ªçš„æ„å»ºè¿‡ç¨‹, ä»–é€šå¸¸åŒ…æ‹¬æ„å»º, æµ‹è¯•å’Œäº¤ä»˜åº”ç”¨ç¨‹åºçš„é˜¶æ®µï¼Œä¸‹é¢æ˜¯è·¯å¾„å’Œä»“åº“çš„é…ç½®</p> <p>â</p></blockquote> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PC1cQc9Ml1KicnVEcshLSTCJJVM4kBRzWuv5ySP2EKksERxulCEib3TtFg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å›¾ç‰‡ç›¸å…³é…ç½®å¦‚ä¸‹ï¼š</p> <ul><li>SCM:é€‰æ‹©gitæˆ–è€…svnä½œä¸ºä»£ç è§¦å‘å™¨</li> <li>è„šæœ¬è·¯å¾„ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºjenkinsfileæ¥ç¼–å†™æµæ°´çº¿</li></ul> <p>ä¸‹é¢ä»‹ç»ä¸€ä¸ªç®€å•ç‰ˆçš„jenkinsfileçš„æµæ°´çº¿ä»»åŠ¡å†™æ³•ï¼Œå®Œæˆæ•´ä¸ªå‰ç«¯å·¥ç¨‹åŒ–éƒ¨ç½²æ¶‰åŠçš„ç¼–è¯‘æ‰“åŒ…ã€é™æ€æ‰«æã€å•å…ƒæµ‹è¯•ç­‰ç¯èŠ‚</p> <div class="language-shell extra-class"><pre class="language-shell"><code>def gitUrl <span class="token operator">=</span> <span class="token string">&quot;http://gitlab.****.com/shc/****.git&quot;</span>//GITå…¥å£ï¼ˆéšä¸åŒå·¥ç¨‹æ”¹å˜ï¼‰
def gitCred <span class="token operator">=</span> <span class="token string">&quot;***-***-4f00-a926-1848b670d97b&quot;</span>    //GIT èº«ä»½å‡­æ®
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;DEV&quot;</span> <span class="token operator">==</span> buildType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    buildScript <span class="token operator">=</span> <span class="token string">&quot;build_development&quot;</span>
    try <span class="token punctuation">{</span>
        node<span class="token punctuation">(</span><span class="token string">'k8s'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            stage<span class="token punctuation">(</span><span class="token string">'ä¸‹æ‹‰æºç '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">'GitSCM'</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">'*/master'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, doGenerateSubmoduleConfigurations: false, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, submoduleCfg: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>credentialsId: <span class="token string">&quot;<span class="token variable">${gitCred}</span>&quot;</span>, url: <span class="token string">&quot;<span class="token variable">${gitUrl}</span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                 <span class="token comment">#å¯ç”±ç‰‡æ®µç”Ÿæˆå™¨ç”Ÿæˆï¼Œé€‰æ‹©ç¤ºä¾‹æ­¥éª¤ â€œcheckout:Check out from version controlâ€ï¼Œç”Ÿæˆæµæ°´çº¿è„šæœ¬è·å–</span>
            <span class="token punctuation">}</span>
            checkStatus<span class="token punctuation">(</span><span class="token string">'ä¸‹æ‹‰æºç '</span><span class="token punctuation">)</span>
            stage<span class="token punctuation">(</span><span class="token string">'ä»£ç æ„å»ºç¼–è¯‘'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&quot;yarn run <span class="token variable">${buildScript}</span>&quot;</span>
            <span class="token punctuation">}</span>
            checkStatus<span class="token punctuation">(</span><span class="token string">'ä»£ç æ„å»ºç¼–è¯‘'</span><span class="token punctuation">)</span>
            stage<span class="token punctuation">(</span><span class="token string">'ä»£ç é™æ€æ‰«æ'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">'yarn run lint'</span>
            <span class="token punctuation">}</span>
            checkStatus<span class="token punctuation">(</span><span class="token string">'ä»£ç é™æ€æ‰«æ'</span><span class="token punctuation">)</span>
            stage<span class="token punctuation">(</span><span class="token string">'å•å…ƒæµ‹è¯•'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token function">sh</span> <span class="token string">'yarn run unit'</span>
            <span class="token punctuation">}</span>
            checkStatus<span class="token punctuation">(</span><span class="token string">'å•å…ƒæµ‹è¯•'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> catch<span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å®Œæˆåï¼Œå³å¯æ„å»ºé¡¹ç›®ï¼Œåˆ†é˜¶æ®µå®Œæˆï¼Œé¦–å…ˆæ˜¯ä¸‹æ‹‰æºç ã€ä»£ç æ„å»ºç¼–è¯‘ã€ä»£ç æ‰«æç­‰ç­‰ï¼Œæ‰€æœ‰ç¯èŠ‚æˆåŠŸæ‰ç®—è‡ªåŠ¨åŒ–éƒ¨ç½²æˆåŠŸï¼Œå¦‚ä¸‹æ‰€ç¤º</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCdwCJZHvjHspD1pk9QoetxhuYMHK5L4WKefwVWEILibc6lelnPUtUD3A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h3 id="_3-docker"><a href="#_3-docker" class="header-anchor">#</a> 3.Docker</h3> <blockquote><p>â</p> <p>Dockeræ˜¯ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå®¹å™¨,å¯ä»¥å°†å¼€å‘ç¯å¢ƒã€ä»£ç ã€é…ç½®æ–‡ä»¶ç­‰ä¸€å¹¶æ‰“åŒ…åˆ°è¿™ä¸ªå®¹å™¨ä¸­,æœ€åå‘å¸ƒåº”ç”¨</p> <p>â</p></blockquote> <h4 id="_3-1-å¦‚ä½•ä½¿ç”¨"><a href="#_3-1-å¦‚ä½•ä½¿ç”¨" class="header-anchor">#</a> 3.1 å¦‚ä½•ä½¿ç”¨</h4> <blockquote><p>â</p> <p>é€šè¿‡å°†éƒ¨ç½²çš„æ“ä½œé›†ä¸­æˆä¸€ä¸ªéƒ¨ç½²è„šæœ¬å®Œæˆä¼ ç»Ÿçš„éƒ¨ç½²æµç¨‹ï¼Œé€šè¿‡åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œdockerå®¹å™¨æ¥è¿è¡Œå‰ç«¯åº”ç”¨</p> <p>â</p></blockquote> <p>å¦‚ä½•å®‰è£…</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> docker-ce
</code></pre></div><p>é¡¹ç›®ç›®å½•ï¼Œéƒ¨ç½²é¡¹ç›®éœ€è¦å‡†å¤‡Dockerfileå’Œnginx.conf(å¦‚æœnginxä¸ä½œå®šåˆ¶åŒ–ï¼Œå¯ä»¥ç›´æ¥ç”¨å®˜æ–¹é•œåƒ)</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PChmIuNhcpbOTv0mibmPa9e3lwcNlE1lkEzia3g5Qj5qTPY2kHcpTia643g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h4 id="_3-2-dockerfile-é…ç½®"><a href="#_3-2-dockerfile-é…ç½®" class="header-anchor">#</a> 3.2 Dockerfile é…ç½®</h4> <blockquote><p>â</p> <p>dockerfileæ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶,ç”¨æ¥è®©docker buildå‘½ä»¤æ¸…æ¥šè¿è¡Œé‚£äº›æ“ä½œï¼Œåˆ›å»ºdockerfileå¹¶ç¼–å†™ç›¸å…³é…ç½®</p> <p>â</p></blockquote> <blockquote><p>æ¯ä¸€ä¸ªæŒ‡ä»¤çš„å‰ç¼€éƒ½å¿…é¡»æ˜¯å¤§å†™çš„</p></blockquote> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> node:latest <span class="token keyword">as</span> builder </span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> package.json </span>
<span class="token instruction"><span class="token keyword">RUN</span> npm install   </span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm run build</span>

<span class="token instruction"><span class="token keyword">FROM</span> nginx:latest</span>
<span class="token instruction"><span class="token keyword">COPY</span> nginx.conf /etc/nginx</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">builder</span></span> /app/dist  /usr/share/nginx/html</span>

<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
</code></pre></div><ul><li><code>ADDå’ŒCOPY</code>ï¼š å°†æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°Dockerfileæ„å»ºçš„é•œåƒä¸­</li> <li><code>EXPOSE</code>ï¼š æŒ‡å®šè¿è¡Œè¯¥é•œåƒçš„å®¹å™¨ä½¿ç”¨çš„ç«¯å£ï¼Œå¯ä»¥æ˜¯å¤šä¸ªã€‚</li> <li><code>RUN</code> ï¼šæŒ‡ä»¤å‘Šè¯‰docker åœ¨é•œåƒå†…æ‰§è¡Œå‘½ä»¤</li> <li><code>FROM</code> ï¼šé€šè¿‡FROMæŒ‡å®šçš„é•œåƒåç§°ï¼Œè¿™ä¸ªé•œåƒç§°ä¹‹ä¸ºåŸºç¡€é•œåƒï¼Œå¿…é¡»ä½äºç¬¬ä¸€æ¡éæ³¨é‡ŠæŒ‡ä»¤</li> <li><code>WORKDIR</code>ï¼š åœ¨å®¹å™¨å†…éƒ¨è®¾ç½®å·¥ä½œç›®å½•</li></ul> <p><code>Nginx.conf</code> é…ç½®å¦‚ä¸‹</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">http</span></span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>   
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åˆ›å»ºæ–‡ä»¶å¹¶ç¼–å†™åï¼Œç”¨dockeråˆ›å»ºé•œåƒ</p> <h4 id="_3-3-å¦‚ä½•åˆ›å»ºé•œåƒ"><a href="#_3-3-å¦‚ä½•åˆ›å»ºé•œåƒ" class="header-anchor">#</a> 3.3 å¦‚ä½•åˆ›å»ºé•œåƒ</h4> <blockquote><p>â</p> <p>ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º frontend</p> <p>â</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> build <span class="token parameter variable">-t</span> frontend <span class="token builtin class-name">.</span>
</code></pre></div><ul><li><p><code>-t</code> ï¼šæŒ‡å®šè¦åˆ›å»ºçš„ç›®æ ‡é•œåƒ</p></li> <li><p><code>.</code> ï¼šDockerfile æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¯ä»¥æŒ‡å®šDockerfile çš„ç»å¯¹è·¯å¾„</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCKkCibqcxfpCrQ0Qr18xAvic9dRm8JtU7Wv6pcIXiahV8ZaMzTGZpZicuTw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCTQup8kuVPUj3gYBM2oibJmQV9v3LXC2YibaBmWGzUMK0pjoOFtFRZI2w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p></li></ul> <p>é•œåƒæˆåŠŸç”Ÿæˆ</p> <h4 id="_3-4-æŸ¥çœ‹é•œåƒ"><a href="#_3-4-æŸ¥çœ‹é•œåƒ" class="header-anchor">#</a> 3.4 æŸ¥çœ‹é•œåƒ</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> image <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> frontend
</code></pre></div><p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCL3Rd1GLk7g0C8dSbvaySlgyn7n7sVYMZib4RdMeNcWszMCxn6TxbLYA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å‡ºç°ç»“æœåˆ™åº”ç”¨é•œåƒ frontend æˆåŠŸåˆ›å»º,ç„¶åæˆ‘ä»¬åŸºäºè¯¥é•œåƒå¯åŠ¨ä¸€ä¸ªDockerå®¹å™¨</p> <h4 id="_4-5-å¦‚ä½•å¯åŠ¨"><a href="#_4-5-å¦‚ä½•å¯åŠ¨" class="header-anchor">#</a> 4.5 å¦‚ä½•å¯åŠ¨</h4> <blockquote><p>â</p> <p>ä½¿ç”¨dockeré•œåƒfrontend:latestä»¥æŒ‡å®š80ç«¯å£æ˜ å°„æ¨¡å¼å¯åŠ¨å®¹å™¨,å¹¶å°†å®¹å™¨å‘½åä¸ºfrontend</p> <p>â</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> frontend <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 frontend:latest
</code></pre></div><ul><li><code>-p</code>: æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£ å°†å®¿ä¸»çš„80ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„80ç«¯å£</li> <li><code>--name</code>: ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›</li></ul> <p>å®Œæˆ <code>docker</code> éƒ¨ç½²</p> <p><code>docker</code>ä¹Ÿå¯ä»¥é›†æˆåˆ°ä¸Šä¸€èŠ‚è®²çš„<code>jenkins</code>è‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿ä¸­å»</p> <div class="language-shell extra-class"><pre class="language-shell"><code>  stage<span class="token punctuation">(</span><span class="token string">'éƒ¨ç½²åˆ°å¼€å‘è”è°ƒç¯å¢ƒ'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;auto deploy to test environment&quot;</span>
    <span class="token function">sh</span> <span class="token string">&quot;docker build -t frontend .&quot;</span>
    <span class="token function">sh</span> <span class="token string">&quot;docker run --name frontend -p 80:80 frontend:latest&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-pm2"><a href="#_4-pm2" class="header-anchor">#</a> 4.PM2</h3> <blockquote><p>â</p> <p>PM2æ˜¯nodeè¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥ç®€åŒ–å¾ˆå¤šnodeåº”ç”¨ç®¡ä¸­ç¹çä»»åŠ¡ï¼Œæ˜¯Nodejsåº”ç”¨ç¨‹åºå®ˆæŠ¤è¿›ç¨‹å¿…ä¸å¯å°‘çš„é€‰æ‹©ï¼Œæ–¹ä¾¿ç®¡ç†åŸºäºnodejså¹³å°ä¸‹èƒ½å¤Ÿæœ‰ç‹¬ç«‹è¿è¡Œè®¿é—®çš„webæœåŠ¡ï¼Œå¦‚nextjsã€expressã€koaç­‰å‰ç«¯åº”ç”¨</p> <p>â</p></blockquote> <h4 id="_4-1-å¸¸è§çš„åº”ç”¨åœºæ™¯"><a href="#_4-1-å¸¸è§çš„åº”ç”¨åœºæ™¯" class="header-anchor">#</a> 4.1 å¸¸è§çš„åº”ç”¨åœºæ™¯</h4> <ul><li>éƒ¨ç½²<code>node koa2</code>æˆ– <code>express</code>é¡¹ç›®åº”ç”¨</li> <li>éƒ¨ç½² å‰ç«¯<code>SSR</code>ï¼ˆåç«¯æ¸²æŸ“ï¼‰åº”ç”¨ï¼Œå¦‚<code>nuxt.jsï¼ˆVueï¼‰</code>å’Œ<code>next.js(React)</code>ç­‰æ„å»ºæœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨æ¡†æ¶</li></ul> <h4 id="_4-2-å¦‚ä½•ä½¿ç”¨"><a href="#_4-2-å¦‚ä½•ä½¿ç”¨" class="header-anchor">#</a> 4.2 å¦‚ä½•ä½¿ç”¨</h4> <ul><li>å®‰è£… ï¼š<code>npm install -g pm2</code></li> <li>å¯åŠ¨nodeé¡¹ç›® : <code>pm2 start app.js æˆ–è€… pm2 start bin/www</code></li> <li>åœæ­¢pm2æœåŠ¡ï¼š<code>pm2 stop bin/www</code></li> <li>åœæ­¢æ‰€æœ‰pm2æœåŠ¡: <code>pm2 stop all</code></li> <li>é‡å¯pm2æœåŠ¡: <code>pm2 restart bin/www</code></li> <li>pm2æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼š<code>pm2 list</code></li></ul> <p>å¯åŠ¨åå¦‚ä¸‹æ‰€ç¤º</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PC9j1G4h6u3HU8Xt3p8tX5N65ImGxibxdtwPrPibGibBvibpD9Xtm9wbqLRg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h4 id="_4-3-é«˜é˜¶åº”ç”¨"><a href="#_4-3-é«˜é˜¶åº”ç”¨" class="header-anchor">#</a> 4.3 é«˜é˜¶åº”ç”¨</h4> <blockquote><p>â</p> <p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªprocesses.json</p> <p>â</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
 #appsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ•°ç»„æˆå‘˜å°±æ˜¯å¯¹åº”ä¸€ä¸ªpm2ä¸­è¿è¡Œçš„åº”ç”¨
  <span class="token property">&quot;apps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>  #åç§°
    <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> #ç¨‹åºå…¥å£
    <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>           #åº”ç”¨ç¨‹åºæ‰€åœ¨çš„ç›®å½•
    <span class="token property">&quot;error_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./logs/err.log&quot;</span><span class="token punctuation">,</span>#é”™è¯¯è¾“å‡ºæ—¥å¿—
    <span class="token property">&quot;log_date_format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;YYYY-MM-DD HH:mm Z&quot;</span> #æ—¥æœŸæ ¼å¼
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç»“åˆ<code>package.json</code>è„šæœ¬å‘½ä»¤ï¼Œå¯ä»¥ç”¨<code>processes</code>æ¥ç®¡ç†å¤šåº”ç”¨</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;script&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;pm2&quot;</span><span class="token operator">:</span><span class="token string">&quot;pm2 start processes.json&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ›´å¤šå‘½ä»¤å’Œé…ç½®ä¿¡æ¯æŸ¥çœ‹ pm2æ–‡æ¡£</p> <h3 id="_5-nginx"><a href="#_5-nginx" class="header-anchor">#</a> 5.Nginx</h3> <blockquote><p>â</p> <p>Nginxå®ƒæ—¢å¯ä»¥ä½œä¸º Web æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå…·å¤‡é«˜æ€§èƒ½ã€é«˜å¹¶å‘è¿æ¥ç­‰</p> <p>â</p></blockquote> <h4 id="_5-1-å‰ç«¯nginxé‚£äº›äº‹"><a href="#_5-1-å‰ç«¯nginxé‚£äº›äº‹" class="header-anchor">#</a> 5.1 å‰ç«¯Nginxé‚£äº›äº‹</h4> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCL6EL0wsMTWxqfsCLsAw2iahQYpo9U0Mcgk0BwUSvbUepver8RFW7K1w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>è¯¦ç»†ä¿¡æ¯è¯·çœ‹ä¹‹å‰æ¢³ç†çš„<a href="http://mp.weixin.qq.com/s?__biz=MjM5OTExNzQ3NQ==&amp;mid=2450958611&amp;idx=1&amp;sn=a4cfe928fd06e93b0da1ce2b602d6e64&amp;chksm=b1225edf8655d7c9fc708c70445b7613f4919dac0d429f5f85d0b05c4d0c98656affd7b6d246&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">å‰ç«¯Nginxé‚£äº›äº‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_5-2-è¡¥å……"><a href="#_5-2-è¡¥å……" class="header-anchor">#</a> 5.2 è¡¥å……</h4> <ul><li>ç°åº¦å‘å¸ƒ</li></ul> <blockquote><p>â</p> <p>ç°åº¦å‘å¸ƒå³æ˜¯è®©ä¸€éƒ¨åˆ†äººç»§ç»­ç”¨æ—§ç‰ˆæœ¬çš„äº§å“Aï¼Œç„¶åä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨æ–°ç‰ˆæœ¬ç‰¹å¾çš„äº§å“Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆé—®é¢˜åé¦ˆï¼Œåˆ™é€æ­¥æ‰©å¤§èŒƒå›´ã€‚ä¸€æ–¹é¢å¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œè€Œä¸”åœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦</p> <p>â</p></blockquote> <p>ä¼ ç»Ÿçš„ç°åº¦æ˜¯é€šè¿‡<code>Nginx</code>åˆ†å‘æµé‡åˆ°æœåŠ¡å™¨ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹ç®€å•çš„ç°åº¦è§„åˆ™é…ç½®ï¼Œé€šè¿‡åœ¨<code>nginx</code>é‡Œé¢é…ç½®è·¯ç”±è§„åˆ™å°±å¥½ï¼Œå¦‚æœæ˜¯è§„åˆ™å¤æ‚çš„è¯,å¯ä»¥ç»“åˆ<code>nginx+lua</code> åšä¸€äº›äº›ç°åº¦çš„ä¸šåŠ¡é€»è¾‘</p> <p>1.æ ¹æ®Cookieå®ç°ç°åº¦å‘å¸ƒ</p> <blockquote><p>â</p> <p>é€šè¿‡è·å–cookieè®¾ç½®çš„ç‰ˆæœ¬å·æ¥åŒºåˆ†</p> <p>â</p></blockquote> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test1</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.0.1:8080 max_fails=1 fail_timeout=60</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">upstream</span> default</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.0.0:8080 max_fails=1 fail_timeout=60</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span>  www.****.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$group</span> <span class="token string">&quot;default&quot;</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_cookie</span> ~* <span class="token string">&quot;version=V1&quot;</span>)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$group</span> test1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>                       
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://<span class="token variable">$group</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span>   Host             <span class="token variable">$host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span>   X-Real-IP        <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span>   X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><ol><li>æ ¹æ®IPå®ç°ç°åº¦å‘å¸ƒ</li></ol> <blockquote><p>â</p> <p>é€šè¿‡å†…å¤–ç½‘IPæ¥åŒºåˆ†</p> <p>â</p></blockquote> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test1</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.0.1:8080 max_fails=1 fail_timeout=60</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">upstream</span> default</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.0.0:8080 max_fails=1 fail_timeout=60</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span>  www.xxx.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$group</span> default</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$remote_addr</span> ~ <span class="token string">&quot;10.0.0.110&quot;</span>)</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$group</span> test1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>                       
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://<span class="token variable">$group</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span>   Host             <span class="token variable">$host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span>   X-Real-IP        <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span>   X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">5/8/2024, 3:01:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/docker/dockerç›¸å…³.html" class="prev">
        å…³äºDockerç›¸å…³å‘½ä»¤
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.5605bad5.js" defer></script><script src="/assets/js/2.57da4f88.js" defer></script><script src="/assets/js/1.a76cc220.js" defer></script><script src="/assets/js/31.ffa03d48.js" defer></script>
  </body>
</html>
