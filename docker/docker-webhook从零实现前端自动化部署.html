<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker + webhook ä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½² | duangdongçš„deploy</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="å‰ç«¯éƒ¨ç½²ç›¸å…³çŸ¥è¯†å½’çº³æ€»ç»“">
    <meta name="keywords" content="qd-blog,vuepress,deploy,algorithm">
    
    <link rel="preload" href="/assets/css/0.styles.b4a844ec.css" as="style"><link rel="preload" href="/assets/js/app.5605bad5.js" as="script"><link rel="preload" href="/assets/js/2.57da4f88.js" as="script"><link rel="preload" href="/assets/js/1.a76cc220.js" as="script"><link rel="preload" href="/assets/js/29.b00b6f3d.js" as="script"><link rel="prefetch" href="/assets/js/10.50f73657.js"><link rel="prefetch" href="/assets/js/11.0390ceee.js"><link rel="prefetch" href="/assets/js/12.f88bec36.js"><link rel="prefetch" href="/assets/js/13.963ad03b.js"><link rel="prefetch" href="/assets/js/14.512f15b9.js"><link rel="prefetch" href="/assets/js/15.a674496c.js"><link rel="prefetch" href="/assets/js/16.ed7e507f.js"><link rel="prefetch" href="/assets/js/17.de667ca5.js"><link rel="prefetch" href="/assets/js/18.b44e84af.js"><link rel="prefetch" href="/assets/js/19.5b5ad6a1.js"><link rel="prefetch" href="/assets/js/20.6800493a.js"><link rel="prefetch" href="/assets/js/21.6589052c.js"><link rel="prefetch" href="/assets/js/22.f648d829.js"><link rel="prefetch" href="/assets/js/23.39476763.js"><link rel="prefetch" href="/assets/js/24.30c66c19.js"><link rel="prefetch" href="/assets/js/25.d4789860.js"><link rel="prefetch" href="/assets/js/26.cd1d4827.js"><link rel="prefetch" href="/assets/js/27.3a1583ca.js"><link rel="prefetch" href="/assets/js/28.c4f500b3.js"><link rel="prefetch" href="/assets/js/3.13e892f5.js"><link rel="prefetch" href="/assets/js/30.b94c8f97.js"><link rel="prefetch" href="/assets/js/31.ffa03d48.js"><link rel="prefetch" href="/assets/js/32.49755c34.js"><link rel="prefetch" href="/assets/js/33.564913a6.js"><link rel="prefetch" href="/assets/js/34.26ee9415.js"><link rel="prefetch" href="/assets/js/35.3c086aef.js"><link rel="prefetch" href="/assets/js/36.7826c489.js"><link rel="prefetch" href="/assets/js/37.e05a3d1a.js"><link rel="prefetch" href="/assets/js/38.9f1b6eb2.js"><link rel="prefetch" href="/assets/js/39.a84b9189.js"><link rel="prefetch" href="/assets/js/4.5bdb9365.js"><link rel="prefetch" href="/assets/js/40.cb6d6026.js"><link rel="prefetch" href="/assets/js/41.861bfae4.js"><link rel="prefetch" href="/assets/js/42.64a03d8e.js"><link rel="prefetch" href="/assets/js/43.79fc731c.js"><link rel="prefetch" href="/assets/js/44.c78ff1b8.js"><link rel="prefetch" href="/assets/js/45.5bf96c84.js"><link rel="prefetch" href="/assets/js/5.7c68fdb5.js"><link rel="prefetch" href="/assets/js/6.c8da7ca7.js"><link rel="prefetch" href="/assets/js/7.e4c88d0e.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5143d2e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4a844ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdongçš„deploy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/deploy/" class="nav-link">
  éƒ¨ç½²
</a></div><div class="nav-item"><a href="/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/cluster/" class="nav-link">
  é›†ç¾¤
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  è¿ç»´
</a></div><div class="nav-item"><a href="/linux-shell/" class="nav-link">
  Linuxç›¸å…³
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/deploy/" class="nav-link">
  éƒ¨ç½²
</a></div><div class="nav-item"><a href="/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/cluster/" class="nav-link">
  é›†ç¾¤
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  è¿ç»´
</a></div><div class="nav-item"><a href="/linux-shell/" class="nav-link">
  Linuxç›¸å…³
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docker/" aria-current="page" class="sidebar-link">éƒ¨ç½²</a></li><li><a href="/docker/NodeJsæœåŠ¡Dockeré•œåƒæè‡´ä¼˜åŒ–æŒ‡åŒ—.html" class="sidebar-link">NodeJS æœåŠ¡ Docker é•œåƒæè‡´ä¼˜åŒ–æŒ‡åŒ—</a></li><li><a href="/docker/docker-webhookä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½².html" class="active sidebar-link">docker + webhook ä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²</a></li><li><a href="/docker/dockerç›¸å…³.html" class="sidebar-link">å…³äºDockerç›¸å…³å‘½ä»¤</a></li><li><a href="/docker/å‰ç«¯è¿ç»´.html" class="sidebar-link">å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker-webhook-ä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#docker-webhook-ä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²" class="header-anchor">#</a> docker + webhook ä»é›¶å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²</h1> <blockquote><p><a href="https://mp.weixin.qq.com/s/_riSVxNdPsbyQf9qAoT4fQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/_riSVxNdPsbyQf9qAoT4fQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>ä½œè€…ï¼šyeyan1996</p> <p>https://juejin.im/post/5ef4c7eff265da230b52dfc5</p></blockquote> <h1 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h1> <p>å¾—ç›Šäº node çš„æ¨ªç©ºå‡ºä¸–ä»¥åŠå‰ç«¯å·¥ç¨‹åŒ–çš„å…´èµ·ï¼Œæ— è®ºæ˜¯å¼€å‘æ¨¡å¼ï¼Œè¿˜æ˜¯å¼€å‘æ¡†æ¶ï¼Œå‰ç«¯ç”Ÿæ€é“¾éƒ½äº§ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œä¸æ­¤åŒæ—¶å‰ç«¯æ…¢æ…¢å¼€å§‹å‘å…¶ä»–é¢†åŸŸæ¢ç´¢ï¼Œé¡¹ç›®éƒ¨ç½²å°±æ˜¯å…¶ä¸­ä¸€ä¸ªé¢†åŸŸ</p> <p>åœ¨åˆ€è€•ç«ç§çš„æ—¶ä»£ï¼Œå½“æ‰§è¡Œ <code>npm run build</code> å°†ç”Ÿæˆäº§ç‰©äº¤ç»™è¿ç»´åï¼Œå‰ç«¯çš„ä»»åŠ¡å°±ç®—å®Œæˆäº†ï¼Œè¿ç»´åŒå­¦åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šå°†äº§ç‰©çš„è·¯å¾„å†™å…¥ nginx é…ç½®æ–‡ä»¶ï¼Œè‡³æ­¤å®Œæˆäº†â€œç®€å•â€çš„éƒ¨ç½²</p> <p>éšç€é¡¹ç›®çš„ä¸æ–­è¿­ä»£ï¼Œå‰ç«¯å¼€å§‹å‘ç°é—®é¢˜çš„ä¸¥é‡æ€§ï¼Œæ¯æ¬¡éƒ½éœ€è¦è€—è´¹å¤§é‡çš„æ—¶é—´åœ¨æ‰“åŒ…ä¸Šï¼Œ<code>å¼€å‘5åˆ†é’Ÿï¼Œæ‰“åŒ…åŠå°æ—¶çš„æƒ…å†µå±¡è§ä¸é²œ</code>ï¼Œå¦å¤–å¼€å‘è€…è‡ªèº«ç¯å¢ƒçš„å·®å¼‚ä¼šå¯¼è‡´æœ€ç»ˆçš„äº§ç‰©ä¹Ÿæœ‰ä¸åŒ</p> <p>ä½†åŠæ³•æ€»æ¯”å›°éš¾å¤šï¼Œä¾‹å¦‚å¯ä»¥å°†æ‰“åŒ…æ“ä½œæ”¾åˆ°è¿œç«¯æœåŠ¡å™¨ä¸Šï¼Œåˆæ¯”å¦‚å¯ä»¥å°†ä¸Šè¿°æµç¨‹ç»“åˆ git ä»“åº“å®ç°è‡ªåŠ¨éƒ¨ç½²</p> <p>æœ¬ç€ä¸è®¾è¾¹ç•Œçš„â€œå­—èŠ‚èŒƒâ€ï¼Œæœ¬æ–‡å°†ä»é›¶å¼€å§‹ï¼Œå®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ï¼Œæ‰“å¼€é¡¹ç›®éƒ¨ç½²çš„â€œé»‘ç›’â€</p> <p>æ¶‰åŠæŠ€æœ¯æ ˆå¦‚ä¸‹ï¼š</p> <ul><li>docker</li> <li>node</li> <li>pm2</li> <li>shell</li> <li>webhook</li></ul> <div class="language- extra-class"><pre class="language-text"><code>æ–‡ç« ä¸­çš„å‘½ä»¤å¤§éƒ¨åˆ†ä¸º linux å‘½ä»¤ï¼Œæœ¬åœ°æ˜¯ windows ç³»ç»Ÿçš„è¯»è€…è¯·ä½¿ç”¨ git bash
</code></pre></div><h1 id="ä»‹ç»-docker"><a href="#ä»‹ç»-docker" class="header-anchor">#</a> ä»‹ç» docker</h1> <p>ç€æ‰‹å¼€å‘å‰ï¼Œå…ˆä»‹ç»è¿™æ¬¡çš„ä¸»è§’ <code>docker</code></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVraWmec8WEqg5I8gmbvibAcnMxvWqWWzWoAM6eyuAnYh9IYL3aeZKoNg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h2 id="ä»€ä¹ˆæ˜¯-docker"><a href="#ä»€ä¹ˆæ˜¯-docker" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ docker</h2> <p>ç®€è€Œè¨€ä¹‹ï¼Œdocker å¯ä»¥çµæ´»çš„åˆ›å»º/é”€æ¯/ç®¡ç†å¤šä¸ª<code>æœåŠ¡å™¨</code>ï¼Œè¿™äº›<code>æœåŠ¡å™¨</code>è¢«ç§°ä¸º <code>å®¹å™¨ (container)</code></p> <p>åœ¨å®¹å™¨ä¸­ä½ å¯ä»¥åšä»»ä½•æœåŠ¡å™¨å¯ä»¥åšçš„äº‹ï¼Œä¾‹å¦‚åœ¨æœ‰ node ç¯å¢ƒçš„å®¹å™¨ä¸­è¿è¡Œ <code>npm run build</code>æ‰“åŒ…é¡¹ç›®ï¼Œåœ¨æœ‰ nginx ç¯å¢ƒçš„å®¹å™¨ä¸­éƒ¨ç½²é¡¹ç›®ï¼Œåœ¨æœ‰ mysql ç¯å¢ƒçš„å®¹å™¨ä¸­åšæ•°æ®å­˜å‚¨ç­‰ç­‰</p> <p>ä¸€æ—¦æœåŠ¡å™¨å®‰è£…äº† docker ï¼Œå°±å¯ä»¥è‡ªç”±åˆ›å»ºä»»æ„å¤šçš„å®¹å™¨ï¼Œä¸Šå›¾ä¸­ docker çš„ logo å½¢è±¡çš„å±•ç¤ºäº†å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼ŒğŸ³å°±æ˜¯ dockerï¼Œä¸Šé¢çš„ä¸€ä¸ªä¸ªé›†è£…ç®±å°±æ˜¯å®¹å™¨</p> <h2 id="å®‰è£…-docker"><a href="#å®‰è£…-docker" class="header-anchor">#</a> å®‰è£… docker</h2> <p>ä¸ºäº†æ–¹ä¾¿æœ¬åœ°è°ƒè¯•ï¼Œå¯ä»¥å…ˆåœ¨æœ¬åœ°å®‰è£… docker</p> <p>Macï¼šhttps://download.docker.com/mac/stable/Docker.dmg</p> <p>Windowsï¼šhttps://download.docker.com/win/stable/Docker%20for%20Windows%20Installer.exe</p> <p>Linuxï¼šhttps://get.docker.com/</p> <p>ä¸‹è½½å®‰è£…å®Œæ¯•åï¼Œç‚¹å‡» docker å›¾æ ‡å¯åŠ¨ dockerï¼Œæ­¤æ—¶åœ¨ç»ˆç«¯ä¸­å°±å¯ä»¥ä½¿ç”¨ docker ç›¸å…³çš„æ“ä½œ</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVLXXics7j9rzLZMgLJUklEmTZ9hYwXXOzHzQgUhnmiaznArN0jQCTNeBw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œæ£€æŸ¥ docker åº”ç”¨ç¨‹åºæ˜¯å¦æ­£å¸¸å¯åŠ¨</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the <span class="token function">docker</span> daemon running?.
</code></pre></div><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="header-anchor">#</a> åŸºæœ¬æ¦‚å¿µ</h2> <p>docker æœ‰ä¸‰ä¸ªé‡è¦çš„æ¦‚å¿µ</p> <ul><li>é•œåƒï¼ˆimageï¼‰</li> <li>å®¹å™¨ï¼ˆcontainerï¼‰</li> <li>ä»“åº“ï¼ˆrepositoryï¼‰</li></ul> <p>å¦‚æœæŠŠå®¹å™¨æ¯”ä½œè½»é‡çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆé•œåƒå°±æ˜¯åˆ›å»ºå®ƒçš„æ¨¡ç‰ˆï¼Œä¸€ä¸ª docker é•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼Œå®ƒä»¬çš„å…³ç³»å¥½æ¯” JavaScript ä¸­ç±»å’Œå®ä¾‹çš„å…³ç³»</p> <p>æœ‰ä¸¤ç§æ–¹å¼è·å–é•œåƒ</p> <ul><li>Dockerfile æ–‡ä»¶åˆ›å»ºè€Œæˆ</li> <li>ç›´æ¥ä½¿ç”¨ dockerHub æˆ–è€…å…¶ä»–ä»“åº“ä¸Šç°æœ‰çš„é•œåƒ</li></ul> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVxtibBMGad36sibV5VQQib6cqWhH5Sf4OpQN3AtUzXNibenQ8kQQhtiaWljg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <blockquote><p>ä»ä»“åº“æˆ–è€…dockerfile =&gt; é•œåƒ =&gt; åˆ›å»ºå®¹å™¨</p></blockquote> <h2 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h2> <blockquote><p>Dockerfile æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼ <code>.gitlab-ci.yml/package.json</code>ï¼Œå®šä¹‰äº†å¦‚ä½•ç”Ÿæˆé•œåƒ</p> <p>å°è¯•ç”¨ Dockerfile åˆ›å»º docker é•œåƒ</p></blockquote> <h3 id="åˆ›å»ºæ–‡ä»¶"><a href="#åˆ›å»ºæ–‡ä»¶" class="header-anchor">#</a> åˆ›å»ºæ–‡ä»¶</h3> <p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>hello-docker</code> ç›®å½•ï¼Œåœ¨ç›®å½•ä¸­åˆ›å»º <code>index.html</code> å’Œ <code>Dockerfile</code> æ–‡ä»¶</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--index.html--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello docker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token comment"># Dockerfile</span>
<span class="token instruction"><span class="token keyword">FROM</span> nginx</span>
<span class="token instruction"><span class="token keyword">COPY</span> index.html /usr/share/nginx/html/index.html</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
</code></pre></div><ul><li>FROM nginxï¼šåŸºäºå®˜æ–¹ nginx é•œåƒ</li> <li>COPY index.html /usr/share/nginx/html/index.htmlï¼š<strong>å°†å½“å‰ç›®å½•ä¸‹ index.html æ›¿æ¢å®¹å™¨ä¸­ /usr/share/nginx/html/index.html æ–‡ä»¶ï¼Œ <code>/usr/share/nginx/html</code> æ˜¯å®¹å™¨ä¸­ nginx é»˜è®¤å­˜æ”¾ç½‘é¡µæ–‡ä»¶çš„ç›®å½•ï¼Œè®¿é—®å®¹å™¨ 80 ç«¯å£ä¼šå±•ç¤ºè¯¥ç›®å½•ä¸‹ index.html æ–‡ä»¶</strong></li> <li>EXPOSE 80ï¼šå®¹å™¨å¯¹å¤–æš´éœ² 80 ç«¯å£ï¼Œä¸»è¦èµ·å£°æ˜ä½œç”¨ï¼ŒçœŸå®ç«¯å£æ˜ å°„è¿˜éœ€è¦åœ¨åˆ›å»ºå®¹å™¨æ—¶å®šä¹‰</li></ul> <p>å…¶ä»– Dockerfile é…ç½®å‚è€ƒå®˜æ–¹æ–‡æ¡£</p> <p>æ­¤æ—¶ï¼Œä½ çš„æ–‡ä»¶ç»“æ„åº”è¯¥æ˜¯</p> <div class="language-shell extra-class"><pre class="language-shell"><code>hello-docker
  <span class="token operator">|</span>____index.html
  <span class="token operator">|</span>____Dockerfile
</code></pre></div><h3 id="åˆ›å»ºé•œåƒ"><a href="#åˆ›å»ºé•œåƒ" class="header-anchor">#</a> åˆ›å»ºé•œåƒ</h3> <p>åœ¨åˆ›å»º Dockerfile æ–‡ä»¶åï¼Œåœ¨å½“å‰ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥åˆ›å»ºä¸€ä¸ª docker é•œåƒ</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> build <span class="token builtin class-name">.</span> <span class="token parameter variable">--pull</span> <span class="token parameter variable">-t</span> test-image:latest
</code></pre></div><ul><li><code>build</code>ï¼šåˆ›å»º docker é•œåƒ</li> <li><code>â€”pull</code>: ä½¿ç¼“å­˜å¤±æ•ˆ</li> <li><code>.</code>ï¼šä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„ dockerfile æ–‡ä»¶</li> <li><code>-t</code>ï¼šä½¿ç”¨ tag æ ‡è®°ç‰ˆæœ¬</li> <li><code>test-image:latest</code>ï¼šåˆ›å»ºåä¸º <code>test-image</code> çš„é•œåƒï¼Œå¹¶æ ‡è®°ä¸º latestï¼ˆæœ€æ–°ï¼‰ç‰ˆæœ¬</li></ul> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVqCVpyuNg2jvggo3ka5J1NibS4u1zd1QYtBb3b6ZiaUwEuETGM8SR3RQw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>é€šè¿‡ <code>docker images</code> å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰é•œåƒ</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVibY7YLWHmL19rjL1z9ug2xL6J9zOiauQLPZkejKqiafVXmn0RQ24QBDKw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h3 id="åˆ›å»ºå®¹å™¨"><a href="#åˆ›å»ºå®¹å™¨" class="header-anchor">#</a> åˆ›å»ºå®¹å™¨</h3> <p>é•œåƒæˆåŠŸåˆ›å»ºåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥åˆ›å»ºä¸€ä¸ª docker å®¹å™¨</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">80</span>:80  <span class="token parameter variable">--name</span> test-container test-image:latest
</code></pre></div><ul><li>runï¼šåˆ›å»ºå¹¶è¿è¡Œ docker å®¹å™¨</li> <li>-dï¼šåå°è¿è¡Œå®¹å™¨</li> <li>80:80ï¼šå°†å½“å‰æœåŠ¡å™¨çš„ 80 ç«¯å£ï¼ˆå†’å·å‰çš„ 80ï¼‰ï¼Œæ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼ˆå†’å·åçš„ 80ï¼‰</li> <li>--nameï¼šç»™å®¹å™¨å‘½åï¼Œä¾¿äºä¹‹åå®šä½å®¹å™¨</li> <li>test-image:latestï¼šåŸºäº <code>test-image</code> æœ€æ–°ç‰ˆæœ¬çš„é•œåƒåˆ›å»ºå®¹å™¨</li></ul> <p>é€šè¿‡ <code>docker ps -a</code> å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVdmgQOqZWjJb2UgibyuwxkFyf6jMCus4nGIzRjck3twW2qPGKY6lZxxQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>ç”±äºæœ¬åœ° 80 ç«¯å£æ˜ å°„åˆ°äº†å®¹å™¨çš„ 80 ç«¯å£ï¼Œæ‰€ä»¥å½“è¾“å…¥ <code>localhost</code> æ—¶ï¼Œä¼šæ˜¾ç¤º index.html æ–‡ä»¶å†…å®¹</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVFJNMJHHEnxITJGa24nqzUPWpAC4ulxLBdEA2m6e5Ou3EzAR7e4jibmw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h2 id="dockerhub"><a href="#dockerhub" class="header-anchor">#</a> dockerHub</h2> <p>å¦‚æœè¯´ github æ˜¯å­˜å‚¨ä»£ç çš„ä»“åº“ï¼Œé‚£ä¹ˆ dockerhub å°±æ˜¯å­˜å‚¨é•œåƒçš„ä»“åº“</p> <p>å¼€å‘è€…å¯ä»¥å°† Dockerfile ç”Ÿæˆçš„é•œåƒä¸Šä¼ åˆ° dockerhub æ¥å­˜å‚¨è‡ªå®šä¹‰é•œåƒï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„é•œåƒ</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull nginx
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">81</span>:80  <span class="token parameter variable">--name</span> nginx-container nginx
</code></pre></div><p>ç¬¬ä¸€æ­¥æ‹‰å–äº†å®˜æ–¹çš„ nginx é•œåƒï¼Œç¬¬äºŒæ­¥ç”¨åŸºäºå®˜æ–¹ nginx é•œåƒåˆ›å»ºåä¸º <code>nginx-container</code> çš„å®¹å™¨</p> <p>ç”±äºä¸Šä¸€æ­¥æ“ä½œæœ¬åœ° 80 ç«¯å£å·²ç»è¢«å ç”¨äº†ï¼Œè¿™é‡Œä½¿ç”¨ 81 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼Œè®¿é—® <code>localhost:81</code> å¯ä»¥çœ‹åˆ° nginx å¯åŠ¨é¡µé¢</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVf00mAdaKCgxDQ55iaUCm1lRibAfXbqsvYlF9B5Eg9m1jm44LOUPSOg6w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h2 id="ä¸ºä»€ä¹ˆè¦ç”¨-docker"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-docker" class="header-anchor">#</a> ä¸ºä»€ä¹ˆè¦ç”¨ docker</h2> <p>äº†è§£äº† docker çš„æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•ï¼Œæ¥ç€è®²è®²ä¸ºä»€ä¹ˆè¦ç”¨ docker</p> <p>æœ‰äººä¼šé—®ï¼Œç¯å¢ƒæˆ‘éƒ½å¯ä»¥è£…åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ”¾åœ¨ä¸€ä¸ªä¸ªå®¹å™¨é‡Œå‘¢ï¼Ÿè¿™é‡Œåˆ—ä¸¾ä½¿ç”¨ docker çš„å‡ ä¸ªä¼˜ç‚¹</p> <h3 id="ç¯å¢ƒç»Ÿä¸€"><a href="#ç¯å¢ƒç»Ÿä¸€" class="header-anchor">#</a> ç¯å¢ƒç»Ÿä¸€</h3> <p>docker çš„å‡ºç°è§£å†³äº†ä¸€ä¸ªä¸–çºªéš¾é¢˜ï¼š<code>åœ¨æˆ‘ç”µè„‘ä¸Šæ˜æ˜æ˜¯å¥½çš„</code> ğŸ˜ƒ</p> <p>å¼€å‘è€…å¯ä»¥å°†å¼€å‘ç¯å¢ƒç”¨ docker é•œåƒä¸Šä¼ åˆ° docker ä»“åº“ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ‹‰å–å¹¶è¿è¡Œç›¸åŒçš„é•œåƒï¼Œä¿æŒç¯å¢ƒä¸€è‡´</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> push yeyan1996/docker-test-image:latest
</code></pre></div><p>æœ¬åœ°æäº¤åä¸º <code>docker-test-image</code> çš„é•œåƒï¼Œé•œåƒåéœ€è¦åŠ ä¸Š dockerhub è´¦å·ä½œä¸ºå‰ç¼€</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> pull yeyan1996/docker-test-image:latest
</code></pre></div><p>æœåŠ¡å™¨æ‹‰å–è´¦å· <code>yeyan1996</code> ä¸‹çš„ <code>docker-test-image</code> é•œåƒ</p> <h3 id="ä¾¿äºå›æ»š"><a href="#ä¾¿äºå›æ»š" class="header-anchor">#</a> ä¾¿äºå›æ»š</h3> <p>ç±»ä¼¼ <code>git</code>ï¼Œ<code>docker</code> ä¹Ÿæœ‰ç‰ˆæœ¬æ§åˆ¶</p> <p>åœ¨åˆ›å»ºé•œåƒæ—¶å¯ä»¥ä½¿ç”¨ <code>tag</code> æ ‡è®°ç‰ˆæœ¬ï¼Œå¦‚æœæŸä¸ªç‰ˆæœ¬çš„ç¯å¢ƒæœ‰é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬</p> <h3 id="ç¯å¢ƒéš”ç¦»"><a href="#ç¯å¢ƒéš”ç¦»" class="header-anchor">#</a> ç¯å¢ƒéš”ç¦»</h3> <p>ä½¿ç”¨ docker å¯ä»¥ä½¿ä½ çš„æœåŠ¡å™¨æ›´å¹²å‡€ï¼Œæ„å»ºç”¨åˆ°çš„ç¯å¢ƒå¯ä»¥éƒ½æ”¾åœ¨å®¹å™¨ä¸­</p> <h3 id="é«˜æ•ˆå¹¶èŠ‚çœèµ„æº"><a href="#é«˜æ•ˆå¹¶èŠ‚çœèµ„æº" class="header-anchor">#</a> é«˜æ•ˆå¹¶èŠ‚çœèµ„æº</h3> <p>ç›¸æ¯”äºçœŸå®æœåŠ¡å™¨/è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸åŒ…å«æ“ä½œç³»ç»Ÿï¼Œè¿™æ„å‘³ç€åˆ›å»º/é”€æ¯å®¹å™¨éƒ½ååˆ†é«˜æ•ˆ</p> <h1 id="å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²" class="header-anchor">#</a> å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²</h1> <p>ä»‹ç»å®Œ dockerï¼Œæ¥ç€æˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²</p> <p>åœ¨æ²¡è¿ç§» Docker ä¹‹å‰ï¼Œè‹¥æˆ‘æƒ³æ›´æ–°çº¿ä¸Šç½‘ç«™ä¸­å†…å®¹æ—¶ï¼Œéœ€è¦ï¼š</p> <ul><li>æœ¬åœ°è¿è¡Œ <code>npm run build</code> ç”Ÿæˆæ„å»ºäº§ç‰©</li> <li>å°†äº§ç‰©é€šè¿‡ ftp ç­‰å½¢å¼ä¸Šä¼ åˆ°æœåŠ¡å™¨</li> <li><code>git push</code> æäº¤ä»£ç åˆ°ä»“åº“</li></ul> <p>åœ¨å®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²åï¼š</p> <ul><li><code>git push</code> æäº¤ä»£ç åˆ°ä»“åº“</li> <li>æœåŠ¡å™¨è‡ªåŠ¨æ›´æ–°é•œåƒ</li> <li>é•œåƒä¸­è‡ªåŠ¨è¿è¡Œ <code>npm run build</code> ç”Ÿæˆæ„å»ºäº§ç‰©</li> <li>æœåŠ¡å™¨è‡ªåŠ¨åˆ›å»ºå®¹å™¨</li></ul> <p>å¯ä»¥å‘ç°ï¼Œå®ç°å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²åå¼€å‘è€…éœ€è¦åšçš„åªæ˜¯æŠŠä»£ç æ¨åˆ°ä»“åº“ï¼Œå…¶ä½™çš„äº‹éƒ½å¯ä»¥é€šè¿‡æœåŠ¡å™¨ä¸Šçš„è‡ªåŠ¨åŒ–è„šæœ¬å®Œæˆ</p> <h1 id="äº‘æœåŠ¡å™¨"><a href="#äº‘æœåŠ¡å™¨" class="header-anchor">#</a> äº‘æœåŠ¡å™¨</h1> <p>é¦–å…ˆä½ å¾—æœ‰ä¸€å°æœåŠ¡å™¨å§-ã€‚-</p> <p>ç”±äºæ˜¯ä¸ªäººé¡¹ç›®ï¼Œå¯¹äº‘æœåŠ¡å™¨çš„è¦æ±‚ä¸é«˜ï¼Œå¤§éƒ¨åˆ†ä¾›åº”å•†ä¼šç»™æ–°ç”¨æˆ·ç™½å«–å…è´¹è¯•ç”¨ 1-2 å‘¨ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©è…¾è®¯äº‘ <code>CentOS 7.6 64ä½</code> çš„æ“ä½œç³»ç»Ÿï¼Œå½“ç„¶é˜¿é‡Œäº‘æˆ–å…¶ä»–äº‘æœåŠ¡å™¨ä¹Ÿå®Œå…¨ ok</p> <h2 id="ç™»é™†äº‘æœåŠ¡å™¨"><a href="#ç™»é™†äº‘æœåŠ¡å™¨" class="header-anchor">#</a> ç™»é™†äº‘æœåŠ¡å™¨</h2> <blockquote><p>ç†Ÿæ‚‰äº‘æœåŠ¡å™¨é…ç½®æˆ–è€…ä¸æ˜¯è…¾è®¯äº‘çš„è¯»è€…å¯ä»¥è·³è¿‡è¿™ç« </p></blockquote> <p>æ³¨å†Œç›¸å…³çš„æ“ä½œä¸ç»†è¯´äº†ï¼Œå‚è€ƒä¾›åº”å•†æ•™ç¨‹ï¼Œéšåç™»é™†æ§åˆ¶å°å¯ä»¥çœ‹åˆ°å½“å‰äº‘æœåŠ¡å™¨çš„å…¬ç½‘ IPï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­æœåŠ¡å™¨çš„å…¬ç½‘ IP æ˜¯ï¼š118.89.244.45</p> <p>å…¬ç½‘ IP ç”¨äºä¹‹å webhook å‘é€è¯·æ±‚çš„åœ°å€</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVy39uDcoicjf9EgbH4LrDpKPTJgqlGBGIKZVnBHiauRBKibMwa8UbE74icw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>ç„¶åæˆ‘ä»¬éœ€è¦ç™»é™†äº‘æœåŠ¡å™¨ï¼Œæœ¬åœ°ç™»é™†äº‘æœåŠ¡å™¨çš„æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼Œå¯†ç ç™»é™†å’Œ ssh ç™»é™†ï¼ˆæˆ–è€…ç”¨ ssh å·¥å…·ï¼Œwindows ç³»ç»Ÿå¯ä»¥ç”¨ xhellï¼ŒmacOS å¯ä»¥ç”¨ puttyï¼‰</p> <p>å‰è€…æ— éœ€é…ç½®ï¼Œä½†æ¯æ¬¡ç™»é™†éƒ½éœ€è¦è¾“å…¥è´¦å·å¯†ç ï¼Œåè€…éœ€è¦æ³¨å†Œ ssh å¯†é’¥ï¼Œä½†ä¹‹åå¯ä»¥å…å¯†ç™»é™†äº‘æœåŠ¡å™¨ã€‚ä¸ªäººæ¯”è¾ƒå–œæ¬¢åè€…ï¼Œæ‰€ä»¥å…ˆåœ¨æ§åˆ¶å°æ³¨å†Œ ssh å¯†é’¥<img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xV5WlDN0kZtYG3OqBl5oCAticQ8UQH1QvdI8FdpA2bSv66ARXFFOEME4A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>ç”Ÿæˆå¯†é’¥çš„æ–¹å¼åŒ gitï¼Œä¹‹å‰ç”Ÿæˆè¿‡çš„è¯æœ¬åœ°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°±èƒ½æŸ¥çœ‹</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">less</span> ~/.ssh/id_rsa.pub
</code></pre></div><p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVibCiaJiblMrIWfVpbB8e4OZFM3IsOWPD7YHCIM2pAw95ENS7ng7e4MAkQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>æ²¡æœ‰ç”Ÿæˆè¿‡å¯†é’¥æœ¬åœ°è¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼Œå‚è€ƒ æœåŠ¡å™¨ä¸Šçš„ Git - ç”Ÿæˆ SSH å…¬é’¥</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ssh-keygen <span class="token parameter variable">-o</span>
Generating public/private rsa key pair.
Enter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/home/schacon/.ssh/id_rsa<span class="token punctuation">)</span>:
Created directory <span class="token string">'/home/schacon/.ssh'</span><span class="token builtin class-name">.</span>
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>:
Enter same passphrase again:
Your identification has been saved <span class="token keyword">in</span> /home/schacon/.ssh/id_rsa.
Your public key has been saved <span class="token keyword">in</span> /home/schacon/.ssh/id_rsa.pub.
The key fingerprint is:
d0:82:24:8e:d7:f1:bb:9b:33:53:96:93:49:da:9b:e3 schacon@mylaptop.local
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">cat</span> ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaCxxxxxxxxxxxxxxxxxxxxxxxxBWDSU
GPl+nafzlHDTYxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxPppSwg0cda3
Pbv7kOdJ/MxxxxxxxxxxxxxxxxxxxxxxxxxxxQwdsdMFvSlVK/7XA
t3FaoJoxxxxxxxxxxxxxxxxxxxxx88XypNDvjYNby6vw/Pb0rwert/En
mZ+AW4OZPnTxxxxxxxxxxxxxxxxxxo1d01QraTlMqVSsbx
NrRFi9wrf+M7Q<span class="token operator">==</span> schacon@mylaptop.local
</code></pre></div><p>å°†ç”Ÿæˆçš„å…¬é’¥æ”¾åœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°å›¾ç¤ºéƒ¨åˆ†ï¼Œç‚¹å‡»ç¡®å®š</p> <p>é™¤äº†æ³¨å†Œå…¬é’¥ï¼Œè¿˜éœ€è¦å°†å®ƒç»‘å®šå®ä¾‹ï¼Œå°†<code>å®ä¾‹å…³æœºå¹¶è¿›è¡Œç»‘å®š</code></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xV45dn4OGnQ2FHdXGKn7cs9x8ia82aiatQZ39vRFUZlLTJax6qaKKd1YNQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>ç»‘å®šå®Œæˆåé‡æ–°å¼€æœºï¼Œè‡³æ­¤å°±å¯ä»¥åœ¨æœ¬åœ°é€šè¿‡ ssh å‘½ä»¤ç™»é™†äº‘æœåŠ¡å™¨å•¦</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ssh</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>@<span class="token operator">&lt;</span>hostname or IP address<span class="token operator">&gt;</span>
</code></pre></div><p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVJQonlfe4PQszgQoqfuJGt59E5udw8wwJ3SWCIg7vpIyZeImbLtVYcg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h2 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="header-anchor">#</a> å®‰è£…ç¯å¢ƒ</h2> <p>æ¥ç€ç»™äº‘æœåŠ¡å™¨å®‰è£…åŸºç¡€çš„ç¯å¢ƒ</p> <h3 id="docker"><a href="#docker" class="header-anchor">#</a> docker</h3> <p>ä¹‹å‰åœ¨æœ¬åœ°å®‰è£…äº† dockerï¼Œä½†äº‘æœåŠ¡å™¨ä¸Šé»˜è®¤ä¹Ÿæ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥éœ€è¦ç»™å®ƒä¹Ÿå®‰è£… docker ç¯å¢ƒ</p> <p>äº‘æœåŠ¡å™¨å®‰è£…å’Œæœ¬åœ°æœ‰äº›åŒºåˆ«ï¼Œæ ¹æ® docker å®˜ç½‘ çš„å®‰è£…æ•™ç¨‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils
<span class="token comment"># Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯ï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ</span>
<span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="token comment"># Step 3: å®‰è£… docker-ce</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io
<span class="token comment"># Step 4: å¼€å¯ dockeræœåŠ¡</span>
<span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
<span class="token comment"># Step 5: è¿è¡Œ hello-world é¡¹ç›®</span>
<span class="token function">sudo</span> <span class="token function">docker</span> run hello-world
</code></pre></div><p>å¼¹å‡º <code>Hello from Docker!</code> è¯æ˜ Docker å·²ç»æˆåŠŸå®‰è£…å•¦ï½</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVle5UibtFTJ9CWiczCibfNh99ukNolgZEOxibw50kXkp6bpc07Z3ReElq7Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h3 id="git"><a href="#git" class="header-anchor">#</a> git</h3> <p>è‡ªåŠ¨åŒ–éƒ¨ç½²æ¶‰åŠåˆ°æ‹‰å–æœ€æ–°çš„ä»£ç ï¼Œæ‰€ä»¥éœ€è¦å®‰è£… git ç¯å¢ƒ</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> <span class="token function">git</span>
</code></pre></div><p>ç”±äº SSH æ–¹å¼è¿˜éœ€è¦åœ¨ github ä¸Šæ³¨å†Œå…¬é’¥ï¼Œæ–¹ä¾¿èµ·è§ï¼Œä¹‹åä¼šé€‰æ‹© HTTPS çš„æ–¹å¼å…‹éš†ä»“åº“</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVBnaUWNeRwnjE3MX9XX2qcWXuNtS5xmHvRlibicN2LqMUic7DbIOrsFzTg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h3 id="node"><a href="#node" class="header-anchor">#</a> node</h3> <p>æ—¢ç„¶æ˜¯å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œäº‘æœåŠ¡å™¨ä¸Šç›¸å…³å¤„ç†é€»è¾‘ç”¨ js ç¼–å†™ï¼Œæ‰€ä»¥éœ€è¦å®‰è£… node ç¯å¢ƒï¼Œè¿™é‡Œç”¨ nvm æ¥ç®¡ç† node ç‰ˆæœ¬</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh <span class="token operator">|</span> <span class="token function">bash</span>
</code></pre></div><p>æ¥ç€éœ€è¦å°† nvm ä½œä¸ºç¯å¢ƒå˜é‡</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">NVM_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$HOME</span>/.nvm&quot;</span><span class="token punctuation">[</span> <span class="token parameter variable">-s</span> <span class="token string">&quot;<span class="token variable">$NVM_DIR</span>/nvm.sh&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>. <span class="token string">&quot;<span class="token variable">$NVM_DIR</span>/nvm.sh&quot;</span>  <span class="token comment"># This loads nvm[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion</span>
</code></pre></div><p>é€šè¿‡ nvm å®‰è£…æœ€æ–°ç‰ˆ node</p> <div class="language-shell extra-class"><pre class="language-shell"><code>nvm <span class="token function">install</span> <span class="token function">node</span>
</code></pre></div><p>node å®‰è£…å®Œæˆåï¼Œè¿˜éœ€è¦å®‰è£… <code>pm2</code>ï¼Œå®ƒèƒ½ä½¿ä½ çš„ js è„šæœ¬èƒ½åœ¨äº‘æœåŠ¡å™¨çš„åå°è¿è¡Œ</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xV4szK9RaoDjcvKq7HDTPHP5Bkhr1NXQv89UuzNCrA4PLjmYxokgicWaQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i pm2 <span class="token parameter variable">-g</span>
</code></pre></div><h1 id="åˆ›å»º-demo-é¡¹ç›®"><a href="#åˆ›å»º-demo-é¡¹ç›®" class="header-anchor">#</a> åˆ›å»º demo é¡¹ç›®</h1> <p>ç®€å•ä½¿ç”¨ vue-cli åœ¨æœ¬åœ°åˆ›å»ºé¡¹ç›®</p> <div class="language-shell extra-class"><pre class="language-shell"><code>vue create docker-test
</code></pre></div><p>å¹¶å°† demo é¡¹ç›®ä¸Šä¼ åˆ° githubï¼Œå‡†å¤‡é…ç½® webhook</p> <h1 id="webhook"><a href="#webhook" class="header-anchor">#</a> webhook</h1> <p>hook ç¿»è¯‘ä¸º<code>é’©å­</code>ï¼Œè¿˜å¯ä»¥ç†è§£ä¸º<code>å›è°ƒ</code></p> <p>å‚è€ƒ Vue ç”Ÿå‘½å‘¨æœŸï¼Œå½“ç»„ä»¶æŒ‚è½½å®Œæˆæ—¶ä¼šè§¦å‘ mounted é’©å­ï¼Œåœ¨é’©å­ä¸­å¯ä»¥ç¼–å†™æ‹‰å–åç«¯æ•°æ®ï¼Œæˆ–è€…æ¸²æŸ“é¡µé¢ç­‰å›è°ƒé€»è¾‘</p> <blockquote><p>github çš„ webhook ä¼šåœ¨å½“å‰ä»“åº“è§¦å‘æŸäº›äº‹ä»¶æ—¶ï¼Œå‘é€ä¸€ä¸ª post å½¢å¼çš„ http è¯·æ±‚</p> <p>å½“ä»“åº“æœ‰æäº¤ä»£ç æ—¶ï¼Œé€šè¿‡å°† webhook è¯·æ±‚åœ°å€æŒ‡å‘äº‘æœåŠ¡å™¨ IP åœ°å€ï¼Œäº‘æœåŠ¡å™¨å°±èƒ½çŸ¥é“é¡¹ç›®æœ‰æ›´æ–°ï¼Œä¹‹åè¿è¡Œç›¸å…³ä»£ç å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²</p></blockquote> <h2 id="é…ç½®-webhook"><a href="#é…ç½®-webhook" class="header-anchor">#</a> é…ç½® webhook</h2> <p>æ‰“å¼€ github çš„ä»“åº“ä¸»é¡µï¼Œç‚¹å‡»å³ä¾§ settings</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVxRYJPcQibRef7sMfpyHMBIcP905n7Ckp85nuunutWQT0UHiaQUPx3yrQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xV2GXvgicRftp74m2508dtzsve5jrPlibwQXusOC3CyOGcPvibGib3BsMlag/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <ul><li>Payload URLï¼šå¡«å†™äº‘æœåŠ¡å™¨å…¬ç½‘ IPï¼Œè®°å¾—æ·»åŠ  http(s) å‰ç¼€</li> <li>Content typeï¼šé€‰æ‹© application/json å³å‘é€ json æ ¼å¼çš„ post è¯·æ±‚</li> <li>è§¦å‘æ—¶æœºï¼šJust the push eventï¼Œå³ä»“åº“ push äº‹ä»¶ï¼Œæ ¹æ®ä¸åŒçš„éœ€æ±‚è¿˜å¯ä»¥é€‰æ‹©å…¶ä»–äº‹ä»¶ï¼Œä¾‹å¦‚ PRï¼Œæäº¤ Commitï¼Œæäº¤ issues ç­‰</li></ul> <p>webhook è¿˜å¯ä»¥è®¾ç½®ä¸€äº›é‰´æƒç›¸å…³çš„ tokenï¼Œç”±äºæ˜¯ä¸ªäººé¡¹ç›®è¿™é‡Œä¸è¯¦ç»†å±•å¼€äº†</p> <p>ç‚¹å‡» <code>Add webhook</code> ä¸ºå½“å‰é¡¹ç›®æ·»åŠ ä¸€ä¸ª webhookï¼Œè‡³æ­¤ï¼Œå½“ <code>docker-test</code> é¡¹ç›®æœ‰ä»£ç æäº¤æ—¶ï¼Œå°±ä¼šå¾€ <code>http://118.89.244.45:3000</code> å‘é€ä¸€ä¸ª post è¯·æ±‚</p> <h2 id="æµ‹è¯•-webhook"><a href="#æµ‹è¯•-webhook" class="header-anchor">#</a> æµ‹è¯• webhook</h2> <p>é…ç½®å®Œæˆåï¼Œå¯ä»¥å‘ä»“åº“æäº¤ä¸€ä¸ª commitï¼Œç„¶åç‚¹å‡»æœ€ä¸‹æ–¹å¯ä»¥çœ‹åˆ° post è¯·æ±‚å‚æ•°</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVety1zxA1tDBzCF8s7H9ica17FCkWoDxTlfeCicaLpia4ECPJuAMfSAFHg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å‚æ•°ä¸»è¦æ¶‰åŠå½“å‰ä»“åº“å’Œæœ¬åœ°æäº¤çš„ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬åªç”¨ <code>repository.name</code> è·å–æ›´æ–°çš„ä»“åº“åå³å¯</p> <h1 id="å¤„ç†é¡¹ç›®æ›´æ–°çš„è¯·æ±‚"><a href="#å¤„ç†é¡¹ç›®æ›´æ–°çš„è¯·æ±‚" class="header-anchor">#</a> å¤„ç†é¡¹ç›®æ›´æ–°çš„è¯·æ±‚</h1> <p>å½“äº‘æœåŠ¡å™¨æ¥æ”¶åˆ°é¡¹ç›®æ›´æ–°åå‘é€çš„ post è¯·æ±‚åï¼Œéœ€è¦åˆ›å»º/æ›´æ–°é•œåƒæ¥å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²</p> <h2 id="åˆ›å»º-dockerfile"><a href="#åˆ›å»º-dockerfile" class="header-anchor">#</a> åˆ›å»º Dockerfile</h2> <p>å…ˆåœ¨æœ¬åœ°é¡¹ç›®é‡Œæ–°å»ºä¸€ä¸ª Dockerfile ç”¨äºä¹‹ååˆ›å»ºé•œåƒ</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token comment"># dockerfile</span>
<span class="token comment"># build stage</span>
<span class="token instruction"><span class="token keyword">FROM</span> node:lts-alpine <span class="token keyword">as</span> build-stage</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> package*.json ./</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm install</span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm run build</span>

<span class="token comment"># production stage</span>
<span class="token instruction"><span class="token keyword">FROM</span> nginx:stable-alpine <span class="token keyword">as</span> production-stage</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build-stage</span></span> /app/dist /usr/share/nginx/html</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;nginx&quot;</span>, <span class="token string">&quot;-g&quot;</span>, <span class="token string">&quot;daemon off;&quot;</span>]</span>
</code></pre></div><p>é€è¡Œè§£æé…ç½®ï¼š</p> <ul><li><code>FROM node:lts-alpine as build-stage</code>ï¼šåŸºäº node  <code>lts-alpine</code> ç‰ˆæœ¬é•œåƒï¼Œå¹¶é€šè¿‡æ„å»ºé˜¶æ®µå‘½åï¼Œå°†æœ‰ node ç¯å¢ƒçš„é˜¶æ®µå‘½åä¸º <code>build-stage</code>ï¼ˆåŒ…å« alpine çš„é•œåƒç‰ˆæœ¬ç›¸æ¯”äº latest ç‰ˆæœ¬æ›´åŠ å°å·§ï¼Œæ›´é€‚åˆä½œä¸º docker é•œåƒä½¿ç”¨ï¼‰</li> <li><code>WORKDIR /app</code>ï¼šå°†å·¥ä½œåŒºè®¾ä¸º /appï¼Œå’Œå…¶ä»–ç³»ç»Ÿæ–‡ä»¶éš”ç¦»</li> <li><code>COPY package*.json ./</code>ï¼šæ‹·è´<code>package.json/package-lock.json</code> åˆ°å®¹å™¨çš„ /app ç›®å½•</li> <li><code>RUN npm install</code>ï¼šè¿è¡Œ <code>npm install</code> åœ¨å®¹å™¨ä¸­å®‰è£…ä¾èµ–</li> <li><code>COPY . .</code>ï¼šæ‹·è´å…¶ä»–æ–‡ä»¶åˆ°å®¹å™¨ /app ç›®å½•ï¼Œåˆ†ä¸¤æ¬¡æ‹·è´æ˜¯å› ä¸ºä¿æŒ <code>node_modules</code>ä¸€è‡´</li> <li><code>RUN npm run build</code>ï¼šè¿è¡Œ <code>npm run build</code> åœ¨å®¹å™¨ä¸­æ„å»º</li></ul> <p>è¿™é‡Œç”¨åˆ°äº† docker ä¸€ä¸ªæŠ€å·§ï¼šå¤šé˜¶æ®µæ„å»º</p> <p>å°†æ„å»ºåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µåŸºäº node é•œåƒï¼Œç¬¬äºŒé˜¶æ®µåŸºäº nginx é•œåƒ</p> <ul><li><code>FROM nginx:lts-alpine as production-stage</code>ï¼šåŸºäº nginx  <code>stable-alpine</code> ç‰ˆæœ¬é•œåƒï¼Œå¹¶å°†æœ‰ nginx ç¯å¢ƒçš„é˜¶æ®µå‘½åä¸º <code>production-stage</code></li> <li><code>COPY --from=build-stage /app/dist /usr/share/nginx/html</code>ï¼šé€šè¿‡ --form å‚æ•°å¯ä»¥<strong>å¼•ç”¨ <code>build-stage</code> é˜¶æ®µç”Ÿæˆçš„äº§ç‰©</strong>ï¼Œå°†å…¶å¤åˆ¶åˆ° <code>/usr/share/nginx/html</code></li> <li><code>EXPOSE 80</code>ï¼šå®¹å™¨å¯¹å¤–æš´éœ² 80 ç«¯å£</li> <li><code>CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</code>ï¼šå®¹å™¨åˆ›å»ºæ—¶è¿è¡Œ <code>nginx -g daemon off</code> å‘½ä»¤ï¼Œ<code>ä¸€æ—¦ CMD å¯¹åº”çš„å‘½ä»¤ç»“æŸï¼Œå®¹å™¨å°±ä¼šè¢«é”€æ¯</code>ï¼Œæ‰€ä»¥é€šè¿‡<code>daemon off è®© nginx</code> ä¸€ç›´åœ¨å‰å°è¿è¡Œ</li></ul> <p>æœ€åé€šè¿‡ <code>scp</code> å‘½ä»¤ï¼Œå°† Dockerfile æ–‡ä»¶å¤åˆ¶åˆ°äº‘æœåŠ¡å™¨ä¸Š</p> <div class="language- extra-class"><pre class="language-text"><code>scp ./Dockerfile root@118.89.244.45:/root
</code></pre></div><h2 id="åˆ›å»º-dockerignore"><a href="#åˆ›å»º-dockerignore" class="header-anchor">#</a> åˆ›å»º .dockerignore</h2> <p>ç±»ä¼¼<code>.gitignore</code>ï¼Œ<code>.dockerignore</code>å¯ä»¥åœ¨åˆ›å»ºé•œåƒå¤åˆ¶æ–‡ä»¶æ—¶å¿½ç•¥å¤åˆ¶æŸäº›æ–‡ä»¶</p> <p>æœ¬åœ°é¡¹ç›®é‡Œæ–°å»º .dockerignore</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># .dockerignore</span>
node_modules
</code></pre></div><p>ç”±äºéœ€è¦<strong>ä¿æŒæœ¬åœ°å’Œå®¹å™¨ä¸­ node_module ä¾èµ–åŒ…ä¸€è‡´</strong>ï¼Œåœ¨åˆ›å»º Dockerfile æ—¶ç”¨äº†ä¸¤æ¬¡ <code>COPY</code> å‘½ä»¤</p> <p>ç¬¬ä¸€æ¬¡åªå¤åˆ¶ <code>package.json</code> å’Œ <code>package-lock.json</code>ï¼Œå¹¶å®‰è£…ä¾èµ–</p> <p>ç¬¬äºŒæ¬¡å¤åˆ¶<strong>é™¤ node_modules</strong>çš„æ‰€æœ‰æ–‡ä»¶</p> <p>æ¥ç€å°†<code>.dockerignore</code> æ–‡ä»¶ä¹Ÿå¤åˆ¶åˆ°äº‘æœåŠ¡å™¨ä¸Š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">scp</span> ./.dockerignore root@118.89.244.45:/root
</code></pre></div><h2 id="åˆ›å»º-http-æœåŠ¡å™¨"><a href="#åˆ›å»º-http-æœåŠ¡å™¨" class="header-anchor">#</a> åˆ›å»º http æœåŠ¡å™¨</h2> <p>ç”±äºæˆ‘ä»¬æ˜¯å‰ç«¯å¼€å‘ï¼Œè¿™é‡Œä½¿ç”¨ node å¼€å¯ä¸€ä¸ªç®€å•çš„ http æœåŠ¡å™¨å¤„ç† webhook å‘é€çš„ post è¯·æ±‚</p> <p>æœ¬åœ°é¡¹ç›®é‡Œæ–°å»º index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'receive request'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is ready'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="æ‹‰å–ä»“åº“ä»£ç "><a href="#æ‹‰å–ä»“åº“ä»£ç " class="header-anchor">#</a> æ‹‰å–ä»“åº“ä»£ç </h2> <p>å½“é¡¹ç›®æ›´æ–°åï¼Œäº‘æœåŠ¡å™¨éœ€è¦å…ˆæ‹‰å–ä»“åº“æœ€æ–°ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>execSync<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span>

 <span class="token comment">// é€’å½’åˆ é™¤ç›®å½•</span>
 <span class="token keyword">function</span> <span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> curPath <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// recurse</span>
                <span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// delete file</span>
                fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">const</span> <span class="token function-variable function">resolvePost</span> <span class="token operator">=</span> <span class="token parameter">req</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">let</span> chunk <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            chunk <span class="token operator">+=</span> data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'receive request'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">resolvePost</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">const</span> projectDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
     <span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span>projectDir<span class="token punctuation">)</span>

  <span class="token comment">// æ‹‰å–ä»“åº“æœ€æ–°ä»£ç </span>
    <span class="token function">execSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git clone https://github.com/yeyan1996/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.git </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>projectDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span>
       <span class="token literal-property property">stdio</span><span class="token operator">:</span><span class="token string">'inherit'</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is ready'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p><code>data.repository.name</code> å³ webhook ä¸­è®°å½•ä»“åº“åçš„å±æ€§</p> <h2 id="åˆ›å»ºé•œåƒå’Œå®¹å™¨"><a href="#åˆ›å»ºé•œåƒå’Œå®¹å™¨" class="header-anchor">#</a> åˆ›å»ºé•œåƒå’Œå®¹å™¨</h2> <p>åœ¨åˆ›å»ºæ–°å®¹å™¨å‰ï¼Œéœ€è¦å…ˆæŠŠæ—§å®¹å™¨é”€æ¯ï¼Œè¿™é‡Œå…ˆä»‹ç»å‡ ä¸ªç”¨åˆ°çš„ docker å‘½ä»¤ï¼š</p> <p>æŸ¥çœ‹æ‰€æœ‰ name ä»¥ docker å¼€å¤´çš„ docker å®¹å™¨ï¼Œå¹¶åªè¾“å‡ºå®¹å™¨å</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;name=^docker&quot;</span> <span class="token parameter variable">--format</span><span class="token operator">=</span><span class="token string">&quot;{{.Names}}&quot;</span>
</code></pre></div><p>åœæ­¢ name ä¸º docker-container çš„å®¹å™¨</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> stop docker-container
</code></pre></div><p>åˆ é™¤ name ä¸º docker-container çš„å®¹å™¨ï¼ˆåœæ­¢çŠ¶æ€çš„å®¹å™¨æ‰èƒ½è¢«åˆ é™¤ï¼‰</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> docker-container
</code></pre></div><p>ç„¶åç»™ index.js æ·»åŠ  docker ç›¸å…³é€»è¾‘</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> execSync <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// é€’å½’åˆ é™¤ç›®å½•</span>
<span class="token keyword">function</span> <span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> curPath <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> file<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// recurse</span>
        <span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// delete file</span>
        fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolvePost</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> chunk <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      chunk <span class="token operator">+=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'receive request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">resolvePost</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> projectDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span>projectDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// æ‹‰å–ä»“åº“æœ€æ–°ä»£ç </span>
      <span class="token function">execSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git clone https://github.com/yeyan1996/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.git </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>projectDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// å¤åˆ¶ Dockerfile åˆ°é¡¹ç›®ç›®å½•</span>
      fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./Dockerfile</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>projectDir<span class="token punctuation">,</span> <span class="token string">'./Dockerfile'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// å¤åˆ¶ .dockerignore åˆ°é¡¹ç›®ç›®å½•</span>
      fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>
        path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./.dockerignore</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>projectDir<span class="token punctuation">,</span> <span class="token string">'./.dockerignore'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// åˆ›å»º docker é•œåƒ</span>
      <span class="token function">execSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">docker build . -t </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-image:latest </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cwd</span><span class="token operator">:</span> projectDir<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// é”€æ¯ docker å®¹å™¨</span>
      <span class="token function">execSync</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">docker ps -a -f &quot;name=^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-container&quot; --format=&quot;{{.Names}}&quot; | xargs -r docker stop | xargs -r docker rm</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// åˆ›å»º docker å®¹å™¨</span>
      <span class="token function">execSync</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">docker run -d -p 8888:80 --name </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-container  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-image:latest</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'deploy success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is ready'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>åœ¨é”€æ¯ docker å®¹å™¨éƒ¨åˆ†ç”¨åˆ°äº† linux çš„ç®¡é“è¿ç®—ç¬¦å’Œ <code>xargs</code> å‘½ä»¤ï¼Œè¿‡æ»¤å‡ºä»¥<code>docker-test</code> å¼€å¤´å®¹å™¨ï¼ˆç”¨ <code>docker-test</code> ä»“åº“çš„ä»£ç åˆ¶ä½œçš„é•œåƒåˆ›å»ºçš„å®¹å™¨ï¼‰ï¼Œåœæ­¢ï¼Œåˆ é™¤å¹¶é‡æ–°åˆ›å»ºå®ƒä»¬</p> <p>åŒæ ·é€šè¿‡ scp å¤åˆ¶åˆ°äº‘æœåŠ¡å™¨ä¸Š</p> <div class="language- extra-class"><pre class="language-text"><code>scp ./index.js root@118.89.244.45:/root
</code></pre></div><h2 id="è¿è¡Œ-node-è„šæœ¬"><a href="#è¿è¡Œ-node-è„šæœ¬" class="header-anchor">#</a> è¿è¡Œ node è„šæœ¬</h2> <p>é€šè¿‡ä¹‹å‰å®‰è£…çš„ pm2 å°† index.js ä½œä¸ºåå°è„šæœ¬åœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡Œ</p> <div class="language- extra-class"><pre class="language-text"><code>pm2 start index.js
</code></pre></div><p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVXYaeCRN58nvoCwMZOXBZkBictbC6CiaVh4aVsBXsrcLTDSabzfCZjnRQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å¯åŠ¨æˆåŠŸåï¼Œè®¿é—®äº‘æœåŠ¡å™¨ 8888 ç«¯å£çœ‹åˆ°éƒ¨ç½²çš„ demo é¡¹ç›®ï¼ˆè®¿é—®å‰ç¡®ä¿æœåŠ¡å™¨å·²å¼€æ”¾ 8888 ç«¯å£ï¼‰</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVfdmANXzkcaNnvM39U7ULBfJdHYaAL0QHvfcVsIo5r42GsicvIzB4sMw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h1 id="try-it"><a href="#try-it" class="header-anchor">#</a> try it</h1> <p>æ¥è¯•è¯•è‡ªåŠ¨åŒ–éƒ¨ç½²çš„æµç¨‹æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œ</p> <p>é¦–å…ˆåœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡Œ <code>pm2 logs</code> æŸ¥çœ‹ index.js è¾“å‡ºçš„æ—¥å¿—ï¼Œéšåæœ¬åœ°æ·»åŠ  <code>hello docker</code> æ–‡æ¡ˆï¼Œå¹¶æ¨é€è‡³ github<img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVnRxl3H8ScJknal7yIamsQSR1tibRryudvufoeTn7Qia0WV8sjBtoG37w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>ä¸å‡ºæ„å¤–ï¼Œpm2 ä¼šè¾“å‡ºå…‹éš†é¡¹ç›®çš„æ—¥å¿—</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVSvXyUOGHsmXiciawYcMm4rq0hD237g4ickTJKnqE0YvxOgQe5n4ygW2iag/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å…‹éš†å®Œæ¯•åå°† Dockerfile å’Œ .dockerignore æ”¾å…¥é¡¹ç›®æ–‡ä»¶ä¸­ï¼Œå¹¶æ›´æ–°é•œåƒ</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVB9XM4lLdvFj7ia0WTSDKe2PiawM71GpWdMx2k3JIRU2V5m1Qsy3nr1rg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">æ¥ç€é”€æ¯æ—§å®¹å™¨ï¼Œå¹¶ä½¿ç”¨æ›´æ–°åçš„é•œåƒåˆ›å»ºå®¹å™¨</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVpmyA0rgYnSOL8TWiamH8ibIMjZIcgOgqjY4lr9bVPAYEohTHMb6KbVow/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>æœ€åè®¿é—® 8888 ç«¯å£å¯ä»¥çœ‹åˆ°æ›´æ–°åçš„æ–‡æ¡ˆ<img src="https://mmbiz.qpic.cn/mmbiz_png/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVuiaP8XKCV3p89GEmlwwhibA2ibEzxNevzJRDbyun2wNnsKfwaKsvCIDOg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å¤§åŠŸå‘Šæˆï½</p> <h1 id="æºç "><a href="#æºç " class="header-anchor">#</a> æºç </h1> <p>Docker-test</p> <p>å…³æ³¨ Dockerfile ï¼Œ.dockerignoreï¼Œ index.js æ–‡ä»¶</p> <h1 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="header-anchor">#</a> å†™åœ¨åé¢</h1> <p>ä¸Šè¿° demo åªåˆ›å»ºäº†å•ä¸ª docker å®¹å™¨ï¼Œå½“é¡¹ç›®æ›´æ–°æ—¶ï¼Œç”±äºå®¹å™¨éœ€è¦ç»è¿‡é”€æ¯å’Œåˆ›å»ºçš„è¿‡ç¨‹ï¼Œä¼šå­˜åœ¨ä¸€æ®µæ—¶é—´é¡µé¢æ— æ³•è®¿é—®æƒ…å†µ</p> <p>è€Œå®é™…æŠ•å…¥ç”Ÿäº§æ—¶ä¸€èˆ¬ä¼šåˆ›å»ºå¤šä¸ªå®¹å™¨ï¼Œå¹¶é€æ­¥æ›´æ–°æ¯ä¸ªå®¹å™¨ï¼Œé…åˆè´Ÿè½½å‡è¡¡å°†ç”¨æˆ·çš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒç«¯å£çš„å®¹å™¨ä¸Šï¼Œç¡®ä¿çº¿ä¸Šçš„æœåŠ¡ä¸ä¼šå› ä¸ºå®¹å™¨çš„æ›´æ–°è€Œå®•æœº</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVu9Or8cDCVAicibDFT4piaHqOvRrVF9sgMYmmuxXAsicdqRmEQ9XEiaG1kicA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å¦å¤–åŸºäº github å¹³å°ä¹Ÿæœ‰éå¸¸æˆç†Ÿçš„ CI/CD å·¥å…·ï¼Œä¾‹å¦‚</p> <ul><li>travis-ci</li> <li>circleci</li></ul> <p>é€šè¿‡ yml é…ç½®æ–‡ä»¶ï¼Œç®€åŒ–ä¸Šæ–‡ä¸­æ³¨å†Œ webhook å’Œç¼–å†™æ›´æ–°å®¹å™¨çš„ index.js è„šæœ¬çš„æ­¥éª¤</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># .travis.yml</span>
<span class="token key atrule">language</span><span class="token punctuation">:</span> node_js
<span class="token key atrule">node_js</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token number">8</span>
<span class="token key atrule">branchs</span><span class="token punctuation">:</span>
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master
<span class="token key atrule">cache</span><span class="token punctuation">:</span>
  <span class="token key atrule">directories</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> node_modules
<span class="token key atrule">install</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> yarn install
<span class="token key atrule">scripts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> yarn test
  <span class="token punctuation">-</span> yarn build
</code></pre></div><p>å¦å¤–éšç€ç¯å¢ƒçš„å¢å¤šï¼Œå®¹å™¨ä¹Ÿä¼šé€æ¸å¢åŠ ï¼Œdocker ä¹Ÿæ¨å‡ºäº†æ›´å¥½ç®¡ç†å¤šä¸ªå®¹å™¨çš„æ–¹å¼  docker-compose</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/C94aicOicyXpJ0xrLbuaTM5S1LQoffm4xVdEicUqDUDFjkVqickjCEybJfpVzABWNB3yHzl0yRuKpibgG6pdWHAU7Ag/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>ä½†æœ¬æ–‡çš„å®—æ—¨è¿˜æ˜¯æ¢ç´¢å…¶ä¸­çš„åŸç†ï¼Œç»´æŠ¤æˆç†Ÿçš„å¼€æºé¡¹ç›®è¿˜æ˜¯æ¨èä½¿ç”¨ä¸Šè¿°å¹³å°</p> <p>æ„Ÿè°¢ä½ èƒ½çœ‹åˆ°è¿™é‡Œï¼Œå¸Œæœ›å¯¹å„ä½æœ‰å¸®åŠ©ï½</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">5/8/2024, 3:01:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/docker/NodeJsæœåŠ¡Dockeré•œåƒæè‡´ä¼˜åŒ–æŒ‡åŒ—.html" class="prev">
        NodeJS æœåŠ¡ Docker é•œåƒæè‡´ä¼˜åŒ–æŒ‡åŒ—
      </a></span> <span class="next"><a href="/docker/dockerç›¸å…³.html">
        å…³äºDockerç›¸å…³å‘½ä»¤
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.5605bad5.js" defer></script><script src="/assets/js/2.57da4f88.js" defer></script><script src="/assets/js/1.a76cc220.js" defer></script><script src="/assets/js/29.b00b6f3d.js" defer></script>
  </body>
</html>
